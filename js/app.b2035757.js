!function(){"use strict";var e,t={94074:function(e,t,a){var i=a(36369),s=(a(48675),a(37380),a(1118),a(82801),a(89096)),r=a(42984),l=a(48082),n=a(92943),o=a(7860),h=a(84133),c=a(23087),p=a(61531),d=a(1384),m=a(12613),u=a(86210),y=a(56276),b=a(29481),f=a(52237),v=a(65615),g=a(83607),k=a(89685),x=a(90937),M=a(83015);class C{constructor(){this.tools=new S,this.hyThree=new w,this.defaultParame=new T,this.engineMode="RUN",this.json=null,this.dom=null,this.scene=null,this.camera=null,this.allCamera={},this.allRenderer={},this.allControls={},this.cameraList=[],this.cameraAbbreviation=9,this.cameraMaxNum=9,this.renderer=null,this.controls=null,this.tfControls=null,this.composer=null,this.renderPass=null,this.outlinePass=null,this.animateId=null,this.isStop=null,this.stats=null,this.selectObject=null,this.activeMaterial=null,this.selectListene=null,this.isDrag=!1,this.canClick=!0,this.dblclick=this.onMouseDblclick.bind(this),this.click=this.onMouseClick.bind(this),this.eventListener={click:{callback:null,fun:this.clickListene.bind(this)},dblclick:{callback:null,fun:this.dblclickListene.bind(this)}},this.timer=null,this.windowResize=this.windowResizeFun.bind(this),this.mixers=null,this.clock=new s.Clock,this.water=null}setEngineMode(e){this.engineMode=e}create(e){this.json=[],this.json.push(this.defaultParame.createScene()),this.json.push(this.defaultParame.createCamera(!0)),this.json.push(this.defaultParame.createRenderer()),this.json.push(this.defaultParame.createControls()),this.init(e,this.json)}init(e,t){this.json=t,this.isStop=!1,this.dom=document.getElementById(e),this.initScene(),this.initSceneContent(this.tools.getSceneJson(this.json)),"EDIT"===this.engineMode?(this.stats=this.hyThree.hyStats(this.dom),this.dom.addEventListener("click",this.click,!1),this.dom.addEventListener("dblclick",this.dblclick,!1),document.onkeydown=this.keydown.bind(this),window.addEventListener("resize",this.windowResize,!1)):(this.engineMode,this.dom.addEventListener("click",this.eventListener.click.fun,!1),this.dom.addEventListener("dblclick",this.eventListener.dblclick.fun,!1),window.addEventListener("resize",this.windowResize,!1)),this.animate()}"着色器"(){var e=new Float32Array([-.5,0,0,.5,0,0,0,.5,0,0,-1,0,.5,0,1,0,1,0]),t=new s.BufferAttribute(e,3),a=new s.BufferGeometry;a.setAttribute("position",t);var i=new s.ShaderMaterial({vertexShader:"\n    // 着色器材质ShaderMaterial不需要引入； 原始着色器材质RawShaderMaterial需要引入\n  // attribute vec3 position;\n  // uniform mat4 projectionMatrix;\n  // uniform mat4 viewMatrix;\n  // uniform mat4 modelMatrix;\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    gl_PointSize = 20.0;\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n  }\n  ",fragmentShader:"\n    varying vec2 vUv;\n    void main() {\n      gl_FragColor = vec4(vUv,1,1.0);\n    }\n  ",depthTest:!1,transparent:!0}),r=new s.Points(a,i);this.scene.add(r)}"水"(){var e=new s.PlaneBufferGeometry(1e4,1e4);this.water=new M.B(e,{textureWidth:512,textureHeight:512,waterNormals:(new s.TextureLoader).load("/textures/waternormals.jpg",(function(e){e.wrapS=e.wrapT=s.RepeatWrapping})),alpha:1,sunColor:16777215,waterColor:7695,distortionScale:1.6,fog:void 0!==this.scene.fog}),this.water.rotation.x=-Math.PI/2,this.scene.add(this.water)}"线"(){const e=new s.MeshStandardMaterial({color:"#f40"}),t=[];t.push(new s.Vector3(-10,0,0)),t.push(new s.Vector3(0,10,0)),t.push(new s.Vector3(10,0,0)),t.push(new s.Vector3(10,0,0));const a=(new s.BufferGeometry).setFromPoints(t),i=new s.LineLoop(a,e);this.scene.add(i);const r=new x.u(t),l=new s.Mesh(r,e);this.scene.add(l);var n=new s.PointsMaterial({color:33023,size:1,alphaTest:.5}),o=a,h=new s.Points(o,n);this.scene.add(h)}"合并对象"(){let e=[];for(let t=0;t<5;t++){let t=new s.BoxGeometry(1,1,1),a=new s.MeshLambertMaterial({color:65535}),i=new s.Mesh(t,a);i.position.set(s.Math.randFloatSpread(10),s.Math.randFloatSpread(10),s.Math.randFloatSpread(10)),e.push(i),this.scene.add(i)}let t=[];for(let a=0;a<e.length;a++)t.push(e[a].geometry);let a=g.O.mergeBufferGeometries(t,!1),i=new s.MeshLambertMaterial({color:16729088}),r=new s.Mesh(a,i);this.scene.add(r)}async"异步循环"(e){for(let t=0;t<e.length;t++){const a=e[t];await this.异步接口调用(a),a.length&&await this.异步循环(e[t])}}async"异步接口调用"(e){return new Promise(((e,t)=>{this.异步接口().then((t=>{e(t)})).catch((e=>{t(e)}))}))}"异步接口"(){return new Promise((e=>{setTimeout((()=>{e("异步接口完成")}),1e3)}))}"内存测试1"(){let e=new s.Group;for(let t=0;t<2e4;t++){let t=new s.BoxGeometry(1,1,1),a=new s.MeshLambertMaterial({color:65535}),i=new s.Mesh(t,a);i.position.set(s.Math.randFloatSpread(100),s.Math.randFloatSpread(100),s.Math.randFloatSpread(100)),e.add(i)}this.scene.add(e)}"内存测试2"(){let e=new s.Group,t=new s.BoxGeometry(1,1,1),a=new s.MeshLambertMaterial({color:65535});for(let i=0;i<2e4;i++){let i=new s.Mesh(t,a);i.position.set(s.Math.randFloatSpread(100),s.Math.randFloatSpread(100),s.Math.randFloatSpread(100)),e.add(i)}this.scene.add(e)}"内存测试3"(){let e=new s.Group,t=new s.BoxGeometry(1,1,1),a=new s.MeshLambertMaterial({color:65535}),i=new s.Mesh(t,a);i.position.set(s.Math.randFloatSpread(100),s.Math.randFloatSpread(100),s.Math.randFloatSpread(100)),e.add(i);for(let t=0;t<19999;t++){let t=i.clone();t.position.set(s.Math.randFloatSpread(100),s.Math.randFloatSpread(100),s.Math.randFloatSpread(100)),e.add(t)}this.scene.add(e)}keydown(e){switch(e.key){case"Delete":this.selectObject&&this.deleteNode(this.selectObject.uuid);break;case"Tab":this.selectObject&&this.cloneNode(this.selectObject.uuid)}}exportBlob(){const e=JSON.stringify(this.json),t=this.tools.encrypt(e);return this.tools.base64toBlob(t)}decryptJson(e){const t=this.tools.decrypt(e);return JSON.parse(t)}exportImage(){return this.renderer.render(this.scene,this.camera),this.renderer.domElement.toDataURL()}exportGltf(){var e=new d.M;return new Promise((t=>{e.parse(this.scene,(function(e){t(e)}))}))}initScene(){this.hyThree.mixers=this.mixers={},this.hyThree.scene=this.scene=this.hyThree.hyScene(this.tools.getSceneJson(this.json)),this.hyThree.cameraList=this.cameraList=this.tools.getCameraListJson(this.json),this.hyThree.allCamera=this.allCamera=this.initAllCamera(this.cameraList),"MULTI"===this.engineMode?(this.hyThree.allRenderer=this.allRenderer=this.initAllRenderer(this.cameraList),this.hyThree.allControls=this.allControls=this.initAllControls(this.cameraList)):(this.hyThree.renderer=this.renderer=this.hyThree.hyRenderer(this.dom,this.tools.getRendererJson(this.json)),this.hyThree.controls=this.controls=this.hyThree.hyControls(this.camera,this.renderer.domElement,this.tools.getControlsJson(this.json))),"EDIT"===this.engineMode&&this.initTFControls()}initAllCamera(e){let t={};for(let a=0;a<e.length;a++){const i=e[a];let s=this.hyThree.hyCamera(this.dom,i);t[s.uuid]=s,0==a&&(this.hyThree.camera=this.camera=s),i.isDefault&&(this.hyThree.camera=this.camera=s)}return t}initAllRenderer(e){let t={},a=e.length,i=Math.sqrt(a),s=Math.round(i),r=Math.ceil(i),l=Math.floor(this.dom.clientWidth/r),n=Math.floor(this.dom.clientHeight/s);for(let a=0;a<e.length;a++){const i=e[a].uuid;let s=this.tools.getRendererJson(this.json),r=this.tools.deepClone(s);for(let e=0;e<r.params.length;e++)if("uuid"===r.params[e].key){r.params.splice(e,1);break}let o=this.hyThree.hyRenderer(this.dom,r,l,n);o.domElement.id=i,t[i]=o,this.allCamera[i].aspect=l/n,this.allCamera[i].updateProjectionMatrix()}return t}initAllControls(e){let t={};for(let a=0;a<e.length;a++){const i=e[a].uuid;let s=this.tools.getControlsJson(this.json),r=this.tools.deepClone(s);for(let e=0;e<r.params.length;e++)if("uuid"===r.params[e].key){r.params.splice(e,1);break}let l=this.hyThree.hyControls(this.allCamera[i],this.allRenderer[i].domElement,r);t[i]=l}return t}initTFControls(){const e=this;this.hyThree.tfControls=this.tfControls=this.hyThree.hyTransformControls(this.camera,this.renderer.domElement),this.tfControls.addEventListener("dragging-changed",(function(t){e.controls.enabled=!t.value,e.isDrag=t.value,t.value?e.canClick=!1:setTimeout((()=>{e.canClick=!0}),10)})),this.hyThree.composer=this.composer=this.hyThree.hyEffectComposer(this.renderer,this.dom),this.renderPass=this.hyThree.hyRenderPass(this.scene,this.camera),this.composer.addPass(this.renderPass),this.hyThree.outlinePass=this.outlinePass=this.hyThree.hyOutlinePass(this.dom,this.scene,this.camera),this.composer.addPass(this.outlinePass)}async initSceneContent(e){let t=e.children,a=e.uuid;if(t&&t.length)for(let e=0;e<t.length;e++){const i=t[e];await this.initContent(i,a),i.children&&await this.initSceneContent(i)}}initContent(e,t){return new Promise((a=>{let i=this.findThreeById(t,this.scene),s=null;switch(e.type){case"BoxGeometry":case"PlaneGeometry":case"CircleGeometry":case"RingGeometry":case"ConeGeometry":case"CylinderGeometry":case"SphereGeometry":case"TorusGeometry":s=this.hyThree.hyMesh(e.type,e);break;case"AmbientLight":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"RectAreaLight":s=this.hyThree.hyLight(e.type,e),s.hyHelper&&s.hyHelperTarget.update&&setTimeout((()=>{s.hyHelperTarget.update()}),1);break;case"SpotLight":s=this.hyThree.hyLight(e.type,e),s.target=i,s.hyHelper&&s.hyHelperTarget.update&&setTimeout((()=>{s.hyHelperTarget.update()}),1);break;case"LineSegments":case"Line":case"LineLoop":case"ConvexGeometry":s=this.hyThree.hyLine(e.type,e);break;case"GridHelper":case"PolarGridHelper":s=this.hyThree.hyHelper(e.type,e);break;case"GlbModel":case"GltfModel":this.hyThree.hyGLTFLoader(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"JsonModel":this.hyThree.hyObjectLoader(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"ObjModel":this.hyThree.hyOBJLoader(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"DaeModel":this.hyThree.hyDAELoader(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"FbxModel":this.hyThree.hyFBXLoader(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"Group":s=this.hyThree.hyGroup(e);break;case"Sprite":s=this.hyThree.hySprite(e);break;case"Text":this.hyThree.hyText(e).then((t=>{e.events&&e.events.length&&(t.hyEvent=!0),i.add(t),a(1)}));break;case"SpriteText":s=this.hyThree.hySpriteText(e);break;case"MergeMesh":s=this.hyThree.hyMergeMesh(e)}s&&(e.events&&e.events.length&&(s.hyEvent=!0),i.add(s),a(1))}))}getPropListTree(){return this.json}getthreeNode(){return{geometries:this.renderer.info.memory.geometries,textures:this.renderer.info.memory.textures,"场景":this.scene,"相机":this.camera,"渲染器":this.renderer,"控制器":this.controls,"渲染器info":this.renderer.info}}createUUID(){return this.tools.createUUID()}setStatsShow(e){this.stats&&(this.stats.domElement.style.display=e?"block":"none")}setOnSelectListener(e){this.selectListene=e}setClickCallback(e){this.eventListener.click.callback=e}setDblclickCallback(e){this.eventListener.dblclick.callback=e}getMenu(e){let t=[],a=[{type:"addMesh",name:"添加网格对象",subMenu:[{type:"BoxGeometry",name:"立方几何体"},{type:"PlaneGeometry",name:"平面几何体"},{type:"CircleGeometry",name:"圆形几何体"},{type:"RingGeometry",name:"环形几何体"},{type:"ConeGeometry",name:"圆锥几何体"},{type:"CylinderGeometry",name:"圆柱几何体"},{type:"SphereGeometry",name:"球形几何体"},{type:"TorusGeometry",name:"圆环几何体"}]},{type:"addLight",name:"添加灯光",subMenu:[{type:"AmbientLight",name:"环境光"},{type:"DirectionalLight",name:"平行光"},{type:"HemisphereLight",name:"半球光"},{type:"PointLight",name:"点光源"},{type:"RectAreaLight",name:"平面光"},{type:"SpotLight",name:"聚光灯"}]},{type:"addSprite",name:"添加精灵"},{type:"addText",name:"添加文本",subMenu:[{type:"addText",name:"3D文本"},{type:"spriteText",name:"标签文本"}]},{type:"addLine",name:"添加线",subMenu:[{type:"LineSegments",name:"线段"},{type:"Line",name:"线"},{type:"LineLoop",name:"环线"},{type:"ConvexGeometry",name:"围栏"}]},{type:"addHelper",name:"添加辅助线",subMenu:[{type:"GridHelper",name:"坐标格辅助"},{type:"PolarGridHelper",name:"极坐标格辅助"}]},{type:"addModel",name:"添加模型"},{type:"addGroup",name:"添加分组"}],i=[{type:"delete",name:"删除"},{type:"clone",name:"克隆"}],s=[{type:"merge",name:"合并网格对象"}],r=[{type:"addEvent",name:"添加事件"}];switch(e){case"Scene":t=t.concat(a);break;case"Group":t=t.concat(s),t=t.concat(a),t=t.concat(i);break;case"LineSegments":case"Line":case"LineLoop":case"ConvexGeometry":case"GridHelper":case"PolarGridHelper":t=t.concat(i);break;case"BoxGeometry":case"PlaneGeometry":case"CircleGeometry":case"RingGeometry":case"ConeGeometry":case"CylinderGeometry":case"SphereGeometry":case"TorusGeometry":case"AmbientLight":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"RectAreaLight":case"SpotLight":case"GlbModel":case"GltfModel":case"JsonModel":case"ObjModel":case"DaeModel":case"FbxModel":case"Sprite":case"Text":case"SpriteText":case"MergeMesh":t=t.concat(r),t=t.concat(i);break;case"Camera":t=t.concat([{type:"addCamera",name:"添加相机"}]),t=t.concat([{type:"deleteCamera",name:"删除相机"}]),t=t.concat([{type:"cloneCamera",name:"克隆相机"}])}return t}clickRightMenu(e,t){let a;t?a=this.findThreeById(t,this.scene):(a=this.findLateContainer(this.selectObject),t=a.uuid);let i=this.findNodeById(t),s=null,r=null;switch(e){case"BoxGeometry":case"PlaneGeometry":case"CircleGeometry":case"RingGeometry":case"ConeGeometry":case"CylinderGeometry":case"SphereGeometry":case"TorusGeometry":s=this.defaultParame.createMesh(e),a.add(this.hyThree.hyMesh(e,s));break;case"AmbientLight":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"RectAreaLight":s=this.defaultParame.createLight(e),r=this.hyThree.hyLight(e,s),a.add(r),r.hyHelper&&r.hyHelperTarget.update&&setTimeout((()=>{r.hyHelperTarget.update()}),1);break;case"SpotLight":s=this.defaultParame.createLight(e),r=this.hyThree.hyLight(e,s),r.target=a,a.add(r),r.hyHelper&&r.hyHelperTarget.update&&setTimeout((()=>{r.hyHelperTarget.update()}),1);break;case"LineSegments":case"Line":case"LineLoop":case"ConvexGeometry":s=this.defaultParame.createLine(e),a.add(this.hyThree.hyLine(e,s));break;case"GridHelper":case"PolarGridHelper":s=this.defaultParame.createHelper(e),a.add(this.hyThree.hyHelper(e,s));break;case"delete":this.deleteNode(t);break;case"clone":this.cloneNode(t);break;case"addGroup":s=this.defaultParame.createGroup("Group"),a.add(this.hyThree.hyGroup(s));break;case"addSprite":s=this.defaultParame.createSprite("Sprite"),a.add(this.hyThree.hySprite(s));break;case"addText":s=this.defaultParame.createText("Text"),this.hyThree.hyText(s).then((e=>{a.add(e)}));break;case"spriteText":s=this.defaultParame.createSpriteText("SpriteText"),a.add(this.hyThree.hySpriteText(s));break;case"merge":this.mergeGroup(t);break;case"addCamera":this.addCamera();break;case"deleteCamera":this.deleteCamera(t);break;case"cloneCamera":this.cloneCamera(t)}s&&(i.children||(i.children=[]))&&(i.children.push(s),this.selectListene(s.uuid))}dropTo(e,t,a){let i=this.findThreeById(e,this.scene),s=this.findThreeById(t,this.scene);a?(i.parent.remove(i),s.parent.add(i)):(i.parent.remove(i),s.add(i)),"SpotLight"===i.type&&(i.target=i.parent)}addModel(e,t){let a=this,i=this.findNodeById(t),s=this.findThreeById(t,this.scene),r=null;switch(r=this.defaultParame.createModel(e),e.type){case"GlbModel":case"GltfModel":this.hyThree.hyGLTFLoader(r).then((e=>{s.add(e),r&&(i.children||(i.children=[]))&&(i.children.push(r),a.selectListene(r.uuid))}));break;case"JsonModel":this.hyThree.hyObjectLoader(r).then((e=>{s.add(e),r&&(i.children||(i.children=[]))&&(i.children.push(r),a.selectListene(r.uuid))}));break;case"ObjModel":this.hyThree.hyOBJLoader(r).then((e=>{s.add(e),r&&(i.children||(i.children=[]))&&(i.children.push(r),a.selectListene(r.uuid))}));break;case"DaeModel":this.hyThree.hyDAELoader(r).then((e=>{s.add(e),r&&(i.children||(i.children=[]))&&(i.children.push(r),a.selectListene(r.uuid))}));break;case"FbxModel":this.hyThree.hyFBXLoader(r).then((e=>{s.add(e),r&&(i.children||(i.children=[]))&&(i.children.push(r),a.selectListene(r.uuid))}))}}addEvent(e,t){let a=this.findNodeById(t),i=this.findThreeById(t,this.scene),s=this.defaultParame.createEvent(e);(a.events||(a.events=[]))&&(a.events.push(s),i.hyEvent=!0)}removeEvent(e){this.findThreeById(e,this.scene).hyEvent=!1}deleteNode(e){let t=this.findThreeById(e,this.scene),a=t.parent.uuid,i=this.findNodeById(a),s=i.children.filter((t=>t.uuid!=e));i.children=s,this.selectObject&&this.selectObject.uuid==e&&(this.notChooseObject(),this.selectListene(null)),t.parent.remove(t),this.disposeNode(t)}disposeNode(e){if(e.hyHelper&&this.deleteNode(e.hyHelper),e.hyAnimation&&delete this.mixers[e.uuid],"Mesh"==e.type&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach((e=>{this.disposeMaterial(e)})):this.disposeMaterial(e.material)),e.children&&e.children.length)for(let t=0;t<e.children.length;t++){const a=e.children[t];this.disposeNode(a)}"Group"==e.type&&e.clear(),e=null}disposeMaterial(e){e.map&&e.map.dispose(),e.alphaMap&&e.alphaMap.dispose(),e.aoMap&&e.aoMap.dispose(),e.envMap&&e.envMap.dispose(),e.lightMap&&e.lightMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.displacementMap&&e.displacementMap.dispose(),e.emissiveMap&&e.emissiveMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.metalnessMap&&e.metalnessMap.dispose(),e.roughnessMap&&e.roughnessMap.dispose(),e.gradientMap&&e.gradientMap.dispose(),e.dispose()}cloneNode(e){let t=this.findNodeById(e),a=this.tools.deepClone(t),i=this.findThreeById(e,this.scene),s=this.hyThree.cloneModel(i);if(i.hyHelper){let e=this.hyThree.hyLightHelper(s);this.scene.add(e),s.hyHelper=e.uuid,s.hyHelperTarget=e}let r=i.parent.uuid,l=this.findNodeById(r);a.uuid=s.uuid;for(let e=0;e<a.params.length;e++)if("uuid"===a.params[e].key){a.params[e].value=a.uuid;break}"Group"==a.type&&a.children&&a.children.length&&(a.children=this.cloneGroupChildren(a.children,s.children,i.children)),l.children.push(a),i.currentMaterial&&(s.material=i.currentMaterial),i.parent.add(s),i.hyAnimation&&(s.animations=i.animations,s.hyAnimation=this.tools.deepClone(i.hyAnimation),this.hyThree.setMixers(s)),this.selectListene(s.uuid)}cloneGroupChildren(e,t,a){for(let i=0;i<e.length;i++){const s=e[i],r=t[i],l=a[i];if(l.hyHelper){let e=this.hyThree.hyLightHelper(r);this.scene.add(e),r.hyHelper=e.uuid,r.hyHelperTarget=e}s.uuid=r.uuid;for(let e=0;e<s.params.length;e++)if("uuid"===s.params[e].key){s.params[e].value=s.uuid;break}"Group"==s.type&&s.children&&s.children.length&&(s.children=this.cloneGroupChildren(s.children,r.children,l.children))}return e}mergeGroup(e){let t=this.findNodeById(e),a=this.findThreeById(e,this.scene),i=[],s=[],r=[];if(a.children.forEach((e=>{e.isMesh&&(i.push(e),r.push(e.uuid))})),t.children.forEach((e=>{switch(e.type){case"MergeMesh":case"BoxGeometry":case"PlaneGeometry":case"CircleGeometry":case"RingGeometry":case"ConeGeometry":case"CylinderGeometry":case"SphereGeometry":case"TorusGeometry":s.push(e)}})),i.length){let e=this.defaultParame.createMergeMesh(s),l=this.hyThree.mergeMesh(i);this.hyThree.setMeshProp(l,"uuid",e.uuid),a.add(l),t.children.push(e),this.selectListene(e.uuid),r.forEach((e=>{this.deleteNode(e)}))}}addCamera(){if(this.cameraList.length>=this.cameraMaxNum)return;let e=this.defaultParame.createCamera(!1);this.json.push(e),this.hyThree.cameraList=this.cameraList=this.tools.getCameraListJson(this.json);let t=this.hyThree.hyCamera(this.dom,e);this.allCamera[t.uuid]=t,this.changeCamera(t.uuid,!0)}deleteCamera(e){if(e===this.camera.uuid)return;let t=this.json.findIndex((t=>t.uuid===e));this.json.splice(t,1),this.hyThree.cameraList=this.cameraList=this.tools.getCameraListJson(this.json),delete this.allCamera[e]}cloneCamera(e){if(this.cameraList.length>=this.cameraMaxNum)return;let t=this.json.find((t=>t.uuid===e)),a=this.tools.deepClone(t),i=this.allCamera[e].clone();a.uuid=i.uuid;for(let e=0;e<a.params.length;e++)if("uuid"===a.params[e].key){a.params[e].value=a.uuid;break}this.json.push(a),this.hyThree.cameraList=this.cameraList=this.tools.getCameraListJson(this.json),this.allCamera[i.uuid]=i,this.changeCamera(i.uuid,!0)}setCameraJson(){this.tools.getCameraJson(this.json,this.camera.uuid).params.forEach((e=>{"position"===e.key&&(e.value.x.value=+this.camera.position.x.toFixed(2),e.value.y.value=+this.camera.position.y.toFixed(2),e.value.z.value=+this.camera.position.z.toFixed(2)),"rotation"===e.key&&(e.value.x.value=+this.camera.rotation.x.toFixed(2),e.value.y.value=+this.camera.rotation.y.toFixed(2),e.value.z.value=+this.camera.rotation.z.toFixed(2)),"quaternion"===e.key&&(e.value.w.value=+this.camera.quaternion.w.toFixed(2),e.value.x.value=+this.camera.quaternion.x.toFixed(2),e.value.y.value=+this.camera.quaternion.y.toFixed(2),e.value.z.value=+this.camera.quaternion.z.toFixed(2))}))}setControlsJson(){this.tools.getControlsJson(this.json).params.forEach((e=>{"target"===e.key&&(e.value.x.value=+this.controls.target.x.toFixed(2),e.value.y.value=+this.controls.target.y.toFixed(2),e.value.z.value=+this.controls.target.z.toFixed(2))}))}setSelectObjectJson(){if(this.isDrag){this.findNodeById(this.selectObject.uuid).params.forEach((e=>{"position"===e.key&&(e.value.x.value=+this.selectObject.position.x.toFixed(2),e.value.y.value=+this.selectObject.position.y.toFixed(2),e.value.z.value=+this.selectObject.position.z.toFixed(2)),"scale"===e.key&&(e.value.x.value=+this.selectObject.scale.x.toFixed(2),e.value.y.value=+this.selectObject.scale.y.toFixed(2),e.value.z.value=+this.selectObject.scale.z.toFixed(2)),"rotation"===e.key&&(e.value.x.value=+this.selectObject.rotation.x.toFixed(2),e.value.y.value=+this.selectObject.rotation.y.toFixed(2),e.value.z.value=+this.selectObject.rotation.z.toFixed(2))})),this.selectObject.hyHelper&&this.selectObject.hyHelperTarget.update&&this.selectObject.hyHelperTarget.update()}}findNodeById(e,t){let a=t||this.json;for(let t=0;t<a.length;t++){const i=a[t];if(i.uuid===e)return i;if(i.children&&i.children.length){const t=this.findNodeById(e,i.children);if(t)return t}}}findLateContainer(e){return e?"Group"===e.type||"Scene"===e.type?e:this.findLateContainer(e.parent):this.scene}findThreeById(e,t){if(t.uuid===e)return t;if(t.children&&t.children.length)for(let a=0;a<t.children.length;a++){const i=t.children[a],s=this.findThreeById(e,i);if(s)return s}}setNodeProp(e,t,a,i){const s=this.findNodeById(e);if("name"===t&&(s[t]=a),s)switch(s.type){case"Scene":this.hyThree.setSceneProp(this.scene,t,a);break;case"Camera":this.hyThree.setCameraProp(this.allCamera[s.uuid],t,a,i),"isDefault"===t&&this.controls&&this.changeCamera(s.uuid,a);break;case"Renderer":this.hyThree.setRendererProp(this.renderer,t,a);break;case"Controls":this.hyThree.setControlsProp(this.controls,t,a,i);break;case"MergeMesh":case"BoxGeometry":case"PlaneGeometry":case"CircleGeometry":case"RingGeometry":case"ConeGeometry":case"CylinderGeometry":case"SphereGeometry":case"TorusGeometry":let r=this.findThreeById(e,this.scene);this.hyThree.setMeshProp(r,t,a,i);break;case"AmbientLight":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"RectAreaLight":case"SpotLight":let l=this.findThreeById(e,this.scene);l=this.hyThree.setLightProp(l,t,a,i),l.hyHelper&&l.hyHelperTarget.update&&setTimeout((()=>{l.hyHelperTarget.update()}),10);break;case"LineSegments":case"Line":case"LineLoop":case"ConvexGeometry":let n=this.findThreeById(e,this.scene);this.hyThree.setLineProp(n,t,a,i);break;case"GridHelper":case"PolarGridHelper":let o=this.findThreeById(e,this.scene);this.hyThree.setHelperProp(o,t,a,i,s);break;case"GlbModel":case"GltfModel":case"JsonModel":case"ObjModel":case"DaeModel":case"FbxModel":let h=this.findThreeById(e,this.scene);this.hyThree.setModelProp(h,t,a,i);break;case"Group":let c=this.findThreeById(e,this.scene);this.hyThree.setGroupProp(c,t,a,i);break;case"Sprite":let p=this.findThreeById(e,this.scene);this.hyThree.setSpriteProp(p,t,a,i);break;case"Text":let d=this.findThreeById(e,this.scene);this.hyThree.setTextProp(d,t,a,i);break;case"SpriteText":let m=this.findThreeById(e,this.scene);if(this.selectObject&&this.selectObject.uuid==e){this.notChooseObject(),this.selectListene(null);let e=this.hyThree.setSpriteTextProp(m,t,a,i,s);this.chooseObject(e),this.selectListene(e.uuid)}else this.hyThree.setSpriteTextProp(m,t,a,i,s)}}stop(){this.isStop=!0,"EDIT"===this.engineMode?(this.dom.removeEventListener("dblclick",this.dblclick,!1),document.onkeydown=null):(this.engineMode,this.dom.removeEventListener("click",this.eventListener.click.fun,!1),this.dom.removeEventListener("dblclick",this.eventListener.dblclick.fun,!1),window.removeEventListener("resize",this.windowResize,!1))}clickNodeObject(e){let t=this.findThreeById(e,this.scene);t&&this.isCanSelect(t)&&this.chooseObject(t)}isCanSelect(e){switch(e.type){case"Mesh":case"Group":case"Sprite":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"RectAreaLight":case"SpotLight":case"LineSegments":case"Line":case"LineLoop":return!0;default:return!1}}onMouseClick(e){if(this.selectObject&&this.selectObject.hyMouseAdd){let t=this.selectObject.hyPoints;if("LineSegments"===this.selectObject.type&&t.length>=2)return;let a=this.getIntersectV3(e);a&&(t.push(a),this.setNodeProp(this.selectObject.uuid,"hyPoints",t))}else if(e.target.clientHeight-e.layerY<e.target.clientHeight/this.cameraAbbreviation){let t=Math.floor(e.layerX/(e.target.clientWidth/this.cameraAbbreviation));this.cameraList.length>1&&this.cameraList[t]&&this.changeCamera(this.cameraList[t].uuid,!0)}}onMouseDblclick(e){if(!this.canClick)return;let t=this.getIntersects(e);if(0!=t.length){let e=this.getParentObj(this.filterHelper(t));e?(this.chooseObject(e),this.selectListene(e.uuid)):this.notChooseObject()}else this.notChooseObject()}clickListene(e){if(clearTimeout(this.timer),"MULTI"!==this.engineMode&&e.target.clientHeight-e.layerY<e.target.clientHeight/this.cameraAbbreviation){let t=Math.floor(e.layerX/(e.target.clientWidth/this.cameraAbbreviation));this.cameraList.length>1&&this.cameraList[t]&&this.changeCamera(this.cameraList[t].uuid,!0)}this.timer=setTimeout((()=>{let t=this.getIntersects(e);if(0!=t.length){let e=this.getEventObj(this.filterHelper(t));if(e){this.getEventsByListener(e.uuid,"click").forEach((t=>{this.eventCallback(e.uuid,t,"click")}))}}}),200)}eventCallback(e,t,a){this.eventListener[a].callback(e,t)}dblclickListene(e){clearTimeout(this.timer);let t=this.getIntersects(e);if(0!=t.length){let e=this.getEventObj(this.filterHelper(t));if(e){this.getEventsByListener(e.uuid,"dblclick").forEach((t=>{this.eventCallback(e.uuid,t,"dblclick")}))}}}filterHelper(e){for(let t=0;t<e.length;t++)if(-1==e[t].object.type.indexOf("Helper")&&-1==e[t].object.type.indexOf("Line")||-1!=e[t].object.type.indexOf("Line")&&e[t].object.name)return e[t].object}getParentObj(e){return e?"Scene"!==e.parent.type||e.parent.parent?this.getParentObj(e.parent):"Mesh"===e.type||"Group"===e.type||"Sprite"===e.type||"LineSegments"===e.type||"Line"===e.type||"LineLoop"===e.type||"Scene"===e.type?e:null:null}getEventObj(e){return e?e.hyEvent?e:this.getEventObj(e.parent):null}getEventsByListener(e,t){return this.findNodeById(e).events.filter((e=>e.listener===t))}chooseObject(e){this.changeMaterial(e),this.outlinePass.selectedObjects=[e],this.setTFControls(e)}notChooseObject(){this.outlinePass.selectedObjects=[],this.changeMaterial(null),this.setTFControls(null)}getIntersects(e){if(e.preventDefault(),"canvas"!==e.target.localName)return[];let t=new s.Raycaster,a=new s.Vector2,i=e.target.id,r=this.allCamera[i]||this.camera;return a.x=e.offsetX/e.target.clientWidth*2-1,a.y=-e.offsetY/e.target.clientHeight*2+1,t.setFromCamera(a,r),t.intersectObjects(this.scene.children,!0)}getIntersectV3(e){e.preventDefault();let t=new s.Raycaster,a=new s.Vector2;a.x=e.offsetX/this.dom.clientWidth*2-1,a.y=-e.offsetY/this.dom.clientHeight*2+1,t.setFromCamera(a,this.camera);let i=new s.Vector3(0,1,0),r=new s.Plane(i,0);return t.ray.intersectPlane(r,new s.Vector3)}changeMaterial(e){e?e!=this.selectObject&&(this.selectObject,this.selectObject=e,this.selectObject.currentMaterial=this.selectObject.material,this.activeMaterial||(this.activeMaterial=new s.MeshLambertMaterial({color:"#ffffff",side:s.DoubleSide,transparent:!0,opacity:.8}))):(this.selectObject&&(this.selectObject.material=this.selectObject.currentMaterial),this.selectObject=null)}setTFControls(e){e?(this.tfControls.attach(e),this.scene.add(this.tfControls)):(this.tfControls.detach(),this.scene.remove(this.tfControls))}setTFControlsMode(e){this.tfControls.setMode(e)}windowResizeFun(){let e=this.dom.clientWidth,t=this.dom.clientHeight;if(e&&t){if("MULTI"===this.engineMode){let a=this.cameraList.length,i=Math.sqrt(a),s=Math.round(i),r=Math.ceil(i);e=Math.floor(this.dom.clientWidth/r),t=Math.floor(this.dom.clientHeight/s)}for(let a=0;a<this.cameraList.length;a++){const i=this.cameraList[a];this.allCamera[i.uuid].aspect=e/t,this.allCamera[i.uuid].updateProjectionMatrix(),"MULTI"===this.engineMode&&this.allRenderer[i.uuid].setSize(e,t)}"RUN"!==this.engineMode&&"EDIT"!==this.engineMode||this.renderer.setSize(e,t)}}updateMixers(){let e=this.clock.getDelta();Object.values(this.mixers).forEach((t=>{t.update(e)}))}changeCamera(e,t){for(let t=0;t<this.cameraList.length;t++){const a=this.cameraList[t];a.isDefault=e===a.uuid;let i=a.params;for(let t=0;t<i.length;t++){const s=i[t];if("isDefault"===s.key){s.value=e===a.uuid;break}}}t&&(this.camera=this.allCamera[e],this.controls.object=this.camera,"EDIT"===this.engineMode&&(this.outlinePass.renderCamera=this.camera,this.renderPass.camera=this.camera,this.tfControls.camera=this.camera))}animate(){this.animateId=requestAnimationFrame(this.animate.bind(this)),"MULTI"===this.engineMode?this.renderMulti():this.render(),this.stats&&this.stats.update()}render(){if(this.hyThree.initCameraLookAt(this.cameraList),"EDIT"===this.engineMode&&(this.setCameraJson(),this.setControlsJson(),this.setSelectObjectJson()),this.updateMixers(),this.isStop){this.disposeNode(this.scene),this.scene.clear(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer.content=null,this.renderer.domElement=null,this.scene=null,this.camera=null,this.allCamera={},this.cameraList=[],this.renderer=null,this.controls=null,this.tfControls=null,this.composer=null,this.outlinePass=null;for(let e=this.dom.childNodes.length;e>0;e--)this.dom.removeChild(this.dom.childNodes[e-1]);this.dom=null,this.tools=null,this.hyThree=null,this.defaultParame=null,this.json=null,cancelAnimationFrame(this.animateId),this.mixers=null}else this.renderCameras();this.water&&(this.water.material.uniforms.time.value+=.5/60)}renderMulti(){if(this.updateMixers(),this.isStop){this.disposeNode(this.scene),this.scene.clear(),this.scene=null,this.camera=null,this.allCamera={},this.allRenderer={},this.allControls={},this.cameraList=[],this.renderer=null,this.controls=null,this.tfControls=null,this.composer=null,this.outlinePass=null;for(let e=this.dom.childNodes.length;e>0;e--)this.dom.removeChild(this.dom.childNodes[e-1]);this.dom=null,this.tools=null,this.hyThree=null,this.defaultParame=null,this.json=null,cancelAnimationFrame(this.animateId),this.mixers=null}else this.renderCameras();this.water&&(this.water.material.uniforms.time.value+=.5/60)}renderCameras(){if("MULTI"===this.engineMode)for(let e=0;e<this.cameraList.length;e++){const t=this.cameraList[e].uuid;this.allControls[t].update(),this.allRenderer[t].render(this.scene,this.allCamera[t])}else if(this.controls.update(),this.renderer.setScissorTest(!1),this.renderer.clear(),this.renderer.setViewport(0,0,this.renderer.domElement.clientWidth,this.renderer.domElement.clientHeight),this.renderer.render(this.scene,this.camera),"EDIT"===this.engineMode&&this.composer.render(),this.cameraList.length>1){let e=this.renderer.domElement.clientWidth/this.cameraAbbreviation,t=this.renderer.domElement.clientHeight/this.cameraAbbreviation;for(let a=0;a<this.cameraList.length;a++){const i=this.cameraList[a];let s=a*e,r=0;this.renderer.setScissor(s,r,e,t),this.renderer.setScissorTest(!0),this.renderer.clear(),this.renderer.setViewport(s+1,r+1,e-2,t-2),this.renderer.render(this.scene,this.allCamera[i.uuid])}}}}class w{constructor(){this.tools=new S,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.tfControls=null,this.composer=null,this.outlinePass=null,this.loadRes={model:{},font:{}},this.mixers=null}hyScene(e){let t=new s.Scene;return this.setScene(t,e.params)}setScene(e,t){return(t||[]).forEach((t=>{t.isEdit&&(e=this.setSceneProp(e,t.key,t.value))})),e}setSceneProp(e,t,a){if("background"===t)e[t]=new s.Color(a);else e[t]=a;return e}hyCamera(e,t){let a=new s.PerspectiveCamera;return this.setCamera(a,e,t.params)}setCamera(e,t,a){return(a||[]).forEach((a=>{a.isEdit?"object"!==a.type?e=this.setCameraProp(e,a.key,a.value):Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(e=this.setCameraProp(e,a.key,i.value,i.key))})):"aspect"===a.key&&(e.aspect=t.clientWidth/t.clientHeight,e.updateProjectionMatrix())})),e}setCameraProp(e,t,a,i){switch(t){case"isDefault":break;case"position":e.position[i]=a,this.controls&&e.lookAt(this.controls.target);break;case"rotation":e.rotation[i]=a;break;case"quaternion":e.quaternion[i]=+a;break;default:e[t]=a}return e.updateProjectionMatrix(),e}initCameraLookAt(e){for(let t=0;t<e.length;t++){const a=e[t];this.allCamera[a.uuid].lookAt(this.controls.target)}}hyRenderer(e,t,a,i){let r=new s.WebGLRenderer({antialias:!0}),l=window.devicePixelRatio<1.5?1.5:window.devicePixelRatio;r.setPixelRatio(l),r.shadowMap.type=s.PCFSoftShadowMap,e.appendChild(r.domElement);let n=a||e.clientWidth,o=i||e.clientHeight;return this.setRenderer(r,t.params,n,o)}setRenderer(e,t,a,i){return(t||[]).forEach((t=>{t.isEdit?e=this.setRendererProp(e,t.key,t.value):"size"===t.key&&e.setSize(a,i)})),e}setRendererProp(e,t,a){if("shadow"===t)e.shadowMap.enabled=a;else e[t]=a;return e}hyControls(e,t,a){let i=new n.z(e,t);return this.setControls(i,a.params)}setControls(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setControlsProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setControlsProp(e,t.key,i.value,i.key))})))})),e}setControlsProp(e,t,a,i){switch(t){case"polarAngle":case"azimuthAngle":e[i]=a||0===a?Math.PI*(a/180):1/0;break;case"target":e.target[i]=+a,e.update();break;default:e[t]=a}return e}hyTransformControls(e,t){return new o.Ys(e,t)}hyEffectComposer(e,t){let a=new h.xC(e);return a.setSize(t.clientWidth,t.clientHeight),a}hyRenderPass(e,t){return new c.C(e,t)}hyOutlinePass(e,t,a){let i=new p.f(new s.Vector2(e.clientWidth,e.clientHeight),t,a,t.children[1]);return this.setOutlinePass(i)}setOutlinePass(e){let t=3,a=0,i=2,s=5,r=!1,l="#b9e1f2",n="#111";return e.edgeStrength=t,e.edgeGlow=a,e.edgeThickness=i,e.pulsePeriod=s,e.usePatternTexture=r,e.visibleEdgeColor.set(l),e.hiddenEdgeColor.set(n),e}hyMesh(e,t){let a=null;switch(e){case"BoxGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={width:e.value.width.value,height:e.value.height.value,depth:e.value.depth.value};a=this.hyBoxGeometry(t)}}));break;case"PlaneGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={width:e.value.width.value,height:e.value.height.value};a=this.hyPlaneGeometry(t)}}));break;case"CircleGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={radius:e.value.radius.value,segments:e.value.segments.value,thetaStart:e.value.thetaStart.value,thetaLength:e.value.thetaLength.value};a=this.hyCircleGeometry(t)}}));break;case"RingGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={innerRadius:e.value.innerRadius.value,outerRadius:e.value.outerRadius.value,thetaSegments:e.value.thetaSegments.value,thetaStart:e.value.thetaStart.value,thetaLength:e.value.thetaLength.value};a=this.hyRingGeometry(t)}}));break;case"ConeGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={radius:e.value.radius.value,height:e.value.height.value,radialSegments:e.value.radialSegments.value,openEnded:e.value.openEnded.value,thetaStart:e.value.thetaStart.value,thetaLength:e.value.thetaLength.value};a=this.hyConeGeometry(t)}}));break;case"CylinderGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={radiusTop:e.value.radiusTop.value,radiusBottom:e.value.radiusBottom.value,height:e.value.height.value,radialSegments:e.value.radialSegments.value,openEnded:e.value.openEnded.value,thetaStart:e.value.thetaStart.value,thetaLength:e.value.thetaLength.value};a=this.hyCylinderGeometry(t)}}));break;case"SphereGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={radius:e.value.radius.value,widthSegments:e.value.widthSegments.value,heightSegments:e.value.heightSegments.value,phiStart:e.value.phiStart.value,phiLength:e.value.phiLength.value,thetaStart:e.value.thetaStart.value,thetaLength:e.value.thetaLength.value};a=this.hySphereGeometry(t)}}));break;case"TorusGeometry":t.params.forEach((e=>{if("parameters"==e.key){let t={radius:e.value.radius.value,tube:e.value.tube.value,radialSegments:e.value.radialSegments.value,tubularSegments:e.value.tubularSegments.value,arc:e.value.arc.value};a=this.hyTorusGeometry(t)}}))}let i=this.hyMaterial({color:"#fff",side:s.DoubleSide}),r=new s.Mesh(a,i);return this.setMesh(r,t.params)}setMesh(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setMeshProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setMeshProp(e,t.key,i.value,i.key))})))})),e}setMeshProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"parameters":{let t=e.geometry.parameters;t[i]!=a&&(t[i]=a,this.setParameters(e,e.geometry.type,t));break}case"material":a&&this.setMaterial(e,a);break;default:e[t]=a}return e}mergeMesh(e){let t=[];for(let a=0;a<e.length;a++){let i=e[a],s=i.geometry.clone();s.scale(i.scale.x,i.scale.y,i.scale.z),s.rotateX(i.rotation.x),s.rotateY(i.rotation.y),s.rotateZ(i.rotation.z),s.translate(i.position.x,i.position.y,i.position.z),t.push(s)}let a=g.O.mergeBufferGeometries(t,!1);for(let e=0;e<t.length;e++)t[e].dispose();let i=this.hyMaterial({color:"#fff",side:s.DoubleSide});return new s.Mesh(a,i)}hyMergeMesh(e){let t=[];e.child.forEach((e=>{if("MergeMesh"===e.type)t.push(this.hyMergeMesh(e));else t.push(this.hyMesh(e.type,e))}));let a=this.mergeMesh(t);return this.setMesh(a,e.params)}setParameters(e,t,a){let i=null;switch(t){case"BoxGeometry":i=this.hyBoxGeometry(a);break;case"PlaneGeometry":i=this.hyPlaneGeometry(a);break;case"CircleGeometry":i=this.hyCircleGeometry(a);break;case"RingGeometry":i=this.hyRingGeometry(a);break;case"ConeGeometry":i=this.hyConeGeometry(a);break;case"CylinderGeometry":i=this.hyCylinderGeometry(a);break;case"SphereGeometry":i=this.hySphereGeometry(a);break;case"TorusGeometry":i=this.hyTorusGeometry(a);break;case"TextGeometry":i=this.hyTextGeometry(e.text,a)}e.geometry.dispose(),e.geometry=i}setMaterial(e,t,a){let i={...t,side:s[t.side]},r=null;["map","bumpMap","alphaMap","roughnessMap","metalnessMap"].forEach((e=>{i=this.setTexture(i,e)})),r=this.hyMaterial(i,a),e.material.dispose(),e.currentMaterial=r,e.material=r}setTexture(e,t){if(e[t]&&e[t].url){let a=(new s.TextureLoader).load(e[t].url);a.wrapS=s[e[t].wrapS],a.wrapT=s[e[t].wrapT],a.repeat.set(e[t].repeatX,e[t].repeatY),e[t]=a}else delete e[t];return e}hyBoxGeometry(e={}){return new s.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}hyPlaneGeometry(e={}){return new s.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}hyCircleGeometry(e={}){return e.thetaLength>2*Math.PI&&(e.thetaLength=2*Math.PI),new s.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)}hyRingGeometry(e={}){return e.thetaLength>2*Math.PI&&(e.thetaLength=2*Math.PI),new s.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}hyConeGeometry(e={}){return e.thetaLength>2*Math.PI&&(e.thetaLength=2*Math.PI),new s.ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}hyCylinderGeometry(e={}){return e.thetaLength>2*Math.PI&&(e.thetaLength=2*Math.PI),new s.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}hySphereGeometry(e={}){return e.phiLength>2*Math.PI&&(e.phiLength=2*Math.PI),e.thetaLength>Math.PI&&(e.thetaLength=Math.PI),new s.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}hyTorusGeometry(e={}){return e.arc>2*Math.PI&&(e.arc=2*Math.PI),new s.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}hyTextGeometry(e,t){return new s.TextGeometry(e,t)}hyMaterial(e,t){let a=null;switch(t){case"SpriteMaterial":a=this.hySpriteMaterial(e);break;case"LineBasicMaterial":a=this.hyLineBasicMaterial(e);break;default:a=this.hyMeshStandardMaterial(e)}return a}hyMeshStandardMaterial(e){return new s.MeshStandardMaterial(e)}hySpriteMaterial(e){return new s.SpriteMaterial(e)}hyLineBasicMaterial(e){return new s.LineBasicMaterial(e)}hyLight(e,t){let a=null,i=null;switch(e){case"AmbientLight":a=new s.AmbientLight;break;case"DirectionalLight":a=new s.DirectionalLight,i=this.hyLightHelper(a),this.scene.add(i),a.hyHelper=i.uuid,a.hyHelperTarget=i;break;case"HemisphereLight":a=new s.HemisphereLight,i=this.hyLightHelper(a),this.scene.add(i),a.hyHelper=i.uuid,a.hyHelperTarget=i;break;case"PointLight":a=new s.PointLight,i=this.hyLightHelper(a),this.scene.add(i),a.hyHelper=i.uuid,a.hyHelperTarget=i;break;case"RectAreaLight":a=new s.RectAreaLight,i=this.hyLightHelper(a),this.scene.add(i),a.hyHelper=i.uuid,a.hyHelperTarget=i;break;case"SpotLight":a=new s.SpotLight,i=this.hyLightHelper(a),this.scene.add(i),a.hyHelper=i.uuid,a.hyHelperTarget=i}return this.setLight(a,t.params)}hyLightHelper(e){let t=null;switch(e.type){case"DirectionalLight":t=new s.DirectionalLightHelper(e);break;case"HemisphereLight":t=new s.HemisphereLightHelper(e);break;case"PointLight":t=new s.PointLightHelper(e);break;case"RectAreaLight":t=new k.Z(e);break;case"SpotLight":t=new s.SpotLightHelper(e)}return t}setLight(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setLightProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setLightProp(e,t.key,i.value,i.key))})))})),e}setLightProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"color":case"groundColor":e[t]=new s.Color(a);break;case"helper":e.hyHelperTarget.visible=a;break;default:e[t]=a}return e}hyLine(e,t){let a=null,i=[],r=null,l=null,n=[];t.params.forEach((e=>{switch(e.key){case"color":r=this.hyMaterial({color:e.value},"LineBasicMaterial");break;case"hyPoints":l=e.value,l.forEach((e=>{n.push(new s.Vector3(e.x,e.y,e.z))}));break;default:i.push(e)}}));let o=(new s.BufferGeometry).setFromPoints(n);switch(e){case"LineSegments":a=new s.LineSegments(o,r);break;case"Line":a=new s.Line(o,r);break;case"LineLoop":a=new s.LineLoop(o,r);break;case"ConvexGeometry":r=this.hyMaterial({color:"#fff",side:s.FrontSide,transparent:!0,opacity:.5}),n.length&&(o=this.hyConvexGeometry(n)),a=new s.Mesh(o,r)}return a.hyPoints=l,this.setLine(a,i)}setLine(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setLineProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setLineProp(e,t.key,i.value,i.key))})))})),e}setLineProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"color":const r=this.hyMaterial({color:a},"LineBasicMaterial");e.material.dispose(),e.material=r,e.currentMaterial=r;break;case"hyPoints":let l=[];a.forEach((e=>{l.push(new s.Vector3(e.x,e.y,e.z))}));let n=null;n="Mesh"===e.type?this.hyConvexGeometry(l):(new s.BufferGeometry).setFromPoints(l),e.geometry.dispose(),e.geometry=n,e[t]=a;break;case"material":a&&this.setMaterial(e,a);break;default:e[t]=a}return e}hyConvexGeometry(e,t=1){let a=[];return e.forEach((e=>{a.push(e),a.push(new s.Vector3(e.x,e.y+t,e.z))})),new x.u(a)}hyHelper(e,t){let a=null,i=[],s={};switch(e){case"GridHelper":t.params.forEach((e=>{switch(e.key){case"size":case"divisions":case"colorCenterLine":case"colorGrid":s[e.key]=e.value;break;default:i.push(e)}})),a=this.hyGridHelper(s);break;case"PolarGridHelper":t.params.forEach((e=>{switch(e.key){case"radius":case"radials":case"circles":case"divisions":case"color1":case"color2":s[e.key]=e.value;break;default:i.push(e)}})),a=this.hyPolarGridHelper(s)}return this.setHelper(a,i)}setHelper(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setHelperProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setHelperProp(e,t.key,i.value,i.key))})))})),e}setHelperProp(e,t,a,i,s){switch(t){case"uuid":case"name":case"visible":e[t]=a;break;default:this.setHelperParams(e,s)}return e}setHelperParams(e,t){let a=e.parent;a.remove(e);let i=this.hyHelper(t.type,t);a.add(i)}hyGridHelper({size:e,divisions:t,colorCenterLine:a,colorGrid:i}){return new s.GridHelper(e,t,a,i)}hyPolarGridHelper({radius:e,radials:t,circles:a,divisions:i,color1:r,color2:l}){return new s.PolarGridHelper(e,t,a,i,r,l)}hyGLTFLoader(e){const t=this;return new Promise(((a,i)=>{if(t.loadRes.model[e.url]){let i=t.loadRes.model[e.url],s=t.cloneModel(i.scene);i.animations.length&&(s.animations=i.animations,s.hyAnimation={type:s.animations[0].name,isPlay:!1}),e.first?t.initModel(s,e):t.setModel(s,e.params),a(s)}else{let s=new m.E,r=new u._;r.setDecoderPath("/libs/draco/gltf/"),s.setDRACOLoader(r),s.load(e.url,(function(i){t.loadRes.model[e.url]=i;let s=t.cloneModel(i.scene);i.animations.length&&(s.animations=i.animations,s.hyAnimation={type:s.animations[0].name,isPlay:!1}),e.first?t.initModel(s,e):t.setModel(s,e.params),a(s)}),void 0,(function(e){i(e)}))}}))}hyObjectLoader(e){const t=this;return new Promise(((a,i)=>{if(t.loadRes.model[e.url]){let i=t.loadRes.model[e.url],r=null;"Scene"===i.type?(r=new s.Group,r.add(t.cloneModel(i))):r=t.cloneModel(i),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}else{(new s.ObjectLoader).load(e.url,(function(i){t.loadRes.model[e.url]=i;let r=null;"Scene"===i.type?(r=new s.Group,r.add(t.cloneModel(i))):r=t.cloneModel(i),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}),void 0,(function(e){i(e)}))}}))}hyOBJLoader(e){const t=this;let a=e.mtl?e.mtl+e.url:e.url;return new Promise(((i,r)=>{if(t.loadRes.model[a]){let r=t.loadRes.model[a],l=null;"Scene"===r.type?(l=new s.Group,l.add(t.cloneModel(r))):l=t.cloneModel(r),e.first?t.initModel(l,e):t.setModel(l,e.params),i(l)}else if(e.mtl){(new b.v).load(e.mtl,(function(l){let n=new y.L;n.setMaterials(l),n.load(e.url,(function(r){t.loadRes.model[a]=r;let l=null;"Scene"===r.type?(l=new s.Group,l.add(t.cloneModel(r))):l=t.cloneModel(r),e.first?t.initModel(l,e):t.setModel(l,e.params),i(l)}),void 0,(function(e){r(e)}))}))}else{(new y.L).load(e.url,(function(r){t.loadRes.model[a]=r;let l=null;"Scene"===r.type?(l=new s.Group,l.add(t.cloneModel(r))):l=t.cloneModel(r),e.first?t.initModel(l,e):t.setModel(l,e.params),i(l)}),void 0,(function(e){r(e)}))}}))}hyDAELoader(e){const t=this;return new Promise(((a,i)=>{if(t.loadRes.model[e.url]){let i=t.loadRes.model[e.url],r=null;"Scene"===i.scene.type?(r=new s.Group,r.add(t.cloneModel(i.scene))):r=t.cloneModel(i.scene),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}else{(new f.G).load(e.url,(function(i){t.loadRes.model[e.url]=i;let r=null;"Scene"===i.scene.type?(r=new s.Group,r.add(t.cloneModel(i.scene))):r=t.cloneModel(i.scene),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}),void 0,(function(e){i(e)}))}}))}hyFBXLoader(e){const t=this;return new Promise(((a,i)=>{if(t.loadRes.model[e.url]){let i=t.loadRes.model[e.url],r=null;"Scene"===i.type?(r=new s.Group,r.add(t.cloneModel(i))):r=t.cloneModel(i),i.animations.length&&(r.animations=i.animations,r.hyAnimation={type:r.animations[0].name,isPlay:!1}),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}else{(new v.y).load(e.url,(function(i){t.loadRes.model[e.url]=i;let r=null;"Scene"===i.type?(r=new s.Group,r.add(t.cloneModel(i))):r=t.cloneModel(i),i.animations.length&&(r.animations=i.animations,r.hyAnimation={type:r.animations[0].name,isPlay:!1}),e.first?t.initModel(r,e):t.setModel(r,e.params),a(r)}),void 0,(function(e){i(e)}))}}))}cloneModel(e){let t=e.clone(),a={},i={},r=!1;return e.traverse((e=>{e.isSkinnedMesh&&(r=!0,i[e.name]=e)})),r&&(t.traverse((e=>{e.isBone&&(a[e.name]=e)})),t.traverse((e=>{if(e.isSkinnedMesh){let t=[];e.skeleton.bones.forEach((e=>{t.push(a[e.name])})),e.bind(new s.Skeleton(t,i[e.name].skeleton.boneInverses),i[e.name].bindMatrix)}}))),t}mergeModel(e){let t=[],a=[];e.traverse((e=>{e.isMesh&&(t.push(e),a.push(e.material))}));let i=[];for(let e=0;e<t.length;e++){let a=t[e],s=a.geometry.clone();s.scale(a.scale.x,a.scale.y,a.scale.z),s.rotateX(a.rotation.x),s.rotateY(a.rotation.y),s.rotateZ(a.rotation.z),s.translate(a.position.x,a.position.y,a.position.z),i.push(s)}let r=g.O.mergeBufferGeometries(i,!1);for(let e=0;e<i.length;e++)i[e].dispose();let l=this.hyMaterial({color:"#fff",side:s.DoubleSide}),n=new s.Mesh(r,l);return e.clear(),e.add(n),e}initModel(e,t){delete t.first,e.name=t.name||"3D模型",e.uuid=t.uuid,e.scale.set(1,1,1);let a=(new s.Box3).setFromObject(e),i=new s.Vector3;a.getSize(i);let r=this.tools.getScale([i.x,i.y,i.z],1,2);e.scale.set(r,r,r);for(let a=0;a<t.params.length;a++){if("scale"==t.params[a].key){t.params[a].value.x.value=r,t.params[a].value.y.value=r,t.params[a].value.z.value=r;break}if("hyAnimation"==t.params[a].key&&e.hyAnimation){t.params[a].isShow=!0;let i=[];e.animations.forEach((e=>{i.push({name:e.name,value:e.name})})),t.params[a].value.type.list=i,t.params[a].value.type.value=i[0].value,e.hyAnimation.type=i[0].value,e.hyAnimation.isPlay=t.params[a].value.isPlay.value,this.setMixers(e)}}}setModel(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setModelProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setModelProp(e,t.key,i.value,i.key))})))})),e}setModelProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"emissive":e.traverse((e=>{e.isMesh&&(a?(e.material.emissive=e.material.color,e.material.emissiveMap=e.material.map):(e.material.emissiveMap&&(e.material.emissiveMap=null),e.material.emissive=new s.Color("#000")),e.material.needsUpdate=!0)}));break;case"hyAnimation":a&&(e[t][i]=a,this.setMixers(e));break;default:e[t]=a}return e}setMixers(e){let t=this.mixers[e.uuid];t||(t=this.mixers[e.uuid]=new s.AnimationMixer(e));let a=t.action;a||(a=t.action={});let i=a[e.hyAnimation.type];i||(i=a[e.hyAnimation.type]=t.clipAction(e.hyAnimation.type)),t.stopAllAction(),e.hyAnimation.isPlay?i.play():i.stop()}hyGroup(e){let t=new s.Group;return this.setGroup(t,e.params)}setGroup(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setGroupProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setGroupProp(e,t.key,i.value,i.key))})))})),e}setGroupProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;default:e[t]=a}return e}hySprite(e){let t=new s.Sprite;return this.setSprite(t,e.params)}setSprite(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setSpriteProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setSpriteProp(e,t.key,i.value,i.key))})))})),e}setSpriteProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"material":a&&(delete a.roughness,delete a.metalness,delete a.wireframe,a.transparent||(delete a.transparent,delete a.opacity),this.setMaterial(e,a,"SpriteMaterial"));break;default:e[t]=a}return e}hyText(e){let t=new s.FontLoader,a=this,i=null,r=null,l=null;return e.params.forEach((e=>{"text"==e.key?r=e.value:"parameters"==e.key?l={size:e.value.size.value,height:e.value.height.value,curveSegments:e.value.curveSegments.value,bevelEnabled:e.value.bevelEnabled.value,bevelThickness:e.value.bevelThickness.value,bevelSize:e.value.bevelSize.value,bevelSegments:e.value.bevelSegments.value}:"fontUrl"==e.key&&(i=e.value)})),new Promise(((n,o)=>{if(a.loadRes.font[i]){let t=a.loadRes.font[i];l.font=t;let o=a.hyTextGeometry(r,l),h=a.hyMaterial({color:"#fff",side:s.DoubleSide}),c=new s.Mesh(o,h);n(a.setText(c,e.params))}else t.load(i,(t=>{a.loadRes.font[i]=t,l.font=t;let o=a.hyTextGeometry(r,l),h=a.hyMaterial({color:"#fff",side:s.DoubleSide}),c=new s.Mesh(o,h);n(a.setText(c,e.params))}),void 0,(function(e){o(e)}))}))}setText(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setTextProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setTextProp(e,t.key,i.value,i.key))})))})),e}setTextProp(e,t,a,i){switch(t){case"position":case"scale":case"rotation":e[t][i]=a;break;case"parameters":{let t=e.geometry.parameters.options;t[i]!=a&&(t[i]=a,this.setParameters(e,e.geometry.type,t));break}case"material":a&&this.setMaterial(e,a);break;case"text":{e[t]=a;let i=e.geometry.parameters.options;this.setParameters(e,e.geometry.type,i);break}default:e[t]=a}return e}hySpriteText(e){let t=null,a=[],i={};return e.params.forEach((e=>{switch(e.key){case"text":case"fontSize":case"textAlign":case"textBaseline":case"fillStyle":case"haveStroke":case"strokeStyle":i[e.key]=e.value;break;default:a.push(e)}})),t=new s.Sprite(this.hyCanvasMaterial(this.hyCanvasText(i))),this.setSpriteText(t,a)}setSpriteText(e,t){return(t||[]).forEach((t=>{t.isEdit&&("object"!==t.type?e=this.setSpriteTextProp(e,t.key,t.value):Object.keys(t.value).forEach((a=>{let i={...t.value[a]};i.isEdit&&(e=this.setSpriteTextProp(e,t.key,i.value,i.key))})))})),e}setSpriteTextProp(e,t,a,i,s){switch(t){case"uuid":case"name":case"visible":e[t]=a;break;case"position":case"scale":case"rotation":e[t][i]=a;break;default:this.setSpriteTextParams(e,s)}return e}setSpriteTextParams(e,t){let a=e.parent;a.remove(e);let i=this.hySpriteText(t);a.add(i)}hyCanvasText({text:e,fontSize:t,textAlign:a,textBaseline:i,fillStyle:s,haveStroke:r,strokeStyle:l}){let n=document.createElement("canvas");n.width=300,n.height=300;let o=n.getContext("2d");return o.font=t+"px Arial",o.textAlign=a,o.textBaseline=i,o.fillStyle=s,o.fillText(e,150,150),o.strokeStyle=l,r&&o.strokeText(e,150,150),n}hyCanvasMaterial(e){return new s.SpriteMaterial({map:new s.CanvasTexture(e)})}hyStats(e){let t=new r;return t.showPanel(0),t.domElement.style.position="absolute",t.domElement.style.right="0px",t.domElement.style.left="",t.domElement.style.display="none",e.appendChild(t.dom),t}hyControls1(e,t){let a=new n.z(e,t);return a.enableDamping=!0,a.dampingFactor=.05,a.enableZoom=!0,a.enableRotate=!0,a.minDistance=1,a.maxDistance=80,a.enablePan=!0,a.minPolarAngle=0,a}}class S{constructor(){this.key=l.enc.Utf8.parse("1234123412ABCDEF"),this.iv=l.enc.Utf8.parse("ABCDEF1234123412")}createUUID(){return"yxxxyxxx-yxxx-yxxx-yxxx-yxxxyxxxyxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}getSceneJson(e){return e.find((e=>"Scene"===e.type))}getCameraJson(e,t){return e.find((e=>"Camera"===e.type&&e.uuid===t))}getCameraListJson(e){return e.filter((e=>"Camera"===e.type))}getRendererJson(e){return e.find((e=>"Renderer"===e.type))}getControlsJson(e){return e.find((e=>"Controls"===e.type))}deepClone(e){return JSON.parse(JSON.stringify(e))}encrypt(e){let t=l.enc.Utf8.parse(e);return l.AES.encrypt(t,this.key,{iv:this.iv,mode:l.mode.CBC,padding:l.pad.Pkcs7}).ciphertext.toString().toUpperCase()}decrypt(e){let t=l.enc.Hex.parse(e),a=l.enc.Base64.stringify(t);return l.AES.decrypt(a,this.key,{iv:this.iv,mode:l.mode.CBC,padding:l.pad.Pkcs7}).toString(l.enc.Utf8).toString()}base64toBlob(e){let t=atob(e),a=t.length,i=new Uint8Array(a);for(;a--;)i[a]=t.charCodeAt(a);return new Blob([i])}getScale(e,t,a){let i=Math.max(...e);return i<t?Math.ceil(t/i):i>a?+/0.0*[0-9]/.exec(a/i)[0]:1}}class T{constructor(){this.tools=new S,this.parame={name:null,type:"string",key:null,value:null,isShow:!0,isEdit:!0},this.publicParame={uuid:{...this.parame,name:"唯一id",key:"uuid",isShow:!1},name:{...this.parame,name:"名称",key:"name"}},this.visible={visible:{...this.parame,name:"是否可见",type:"boolean",key:"visible"}},this.transform={position:{...this.parame,name:"位置",type:"object",key:"position",flex:!0,value:{x:{...this.parame,name:"x",type:"number",key:"x",step:.01},y:{...this.parame,name:"y",type:"number",key:"y",step:.01},z:{...this.parame,name:"z",type:"number",key:"z",step:.01}}},scale:{...this.parame,name:"缩放",type:"object",key:"scale",flex:!0,value:{x:{...this.parame,name:"x",type:"number",key:"x",step:.01},y:{...this.parame,name:"y",type:"number",key:"y",step:.01},z:{...this.parame,name:"z",type:"number",key:"z",step:.01}}},rotation:{...this.parame,name:"旋转",type:"object",key:"rotation",flex:!0,value:{x:{...this.parame,name:"x",type:"number",key:"x",step:.01},y:{...this.parame,name:"y",type:"number",key:"y",step:.01},z:{...this.parame,name:"z",type:"number",key:"z",step:.01}}}},this.shadow={castShadow:{...this.parame,name:"投射阴影",type:"boolean",key:"castShadow"},receiveShadow:{...this.parame,name:"接收阴影",type:"boolean",key:"receiveShadow"}},this.scene={defaults:{background:"#F7F2A5"},parame:{background:{...this.parame,name:"背景颜色",key:"background",type:"color"}}},this.camera={defaults:{fov:75,near:.1,far:200,zoom:1,position:{x:0,y:1,z:5},rotation:{x:0,y:0,z:0},quaternion:{w:1,x:0,y:0,z:0}},parame:{isDefault:{...this.parame,name:"主视角",type:"boolean",key:"isDefault"},aspect:{...this.parame,name:"摄像机视锥体的长宽比",key:"aspect",type:"number",remark:"摄像机视锥体的长宽比，不可编辑，自动获取容器宽高，画布变动需要更新",isShow:!1,isEdit:!1},fov:{...this.parame,name:"视野角度",type:"number",key:"fov",min:0,max:180},near:{...this.parame,name:"近端面",type:"number",key:"near",min:0},far:{...this.parame,name:"远端面",type:"number",key:"far",min:0},zoom:{...this.parame,name:"缩放倍数",type:"number",key:"zoom",min:.1,step:.1},position:{...this.transform.position},rotation:{...this.transform.rotation},quaternion:{...this.parame,name:"四元素",type:"object",key:"quaternion",flex:!0,value:{w:{...this.parame,name:"w",type:"number",key:"w"},x:{...this.parame,name:"x",type:"number",key:"x"},y:{...this.parame,name:"y",type:"number",key:"y"},z:{...this.parame,name:"z",type:"number",key:"z"}}}}},this.renderer={defaults:{shadow:!0},parame:{size:{...this.parame,name:"渲染器宽高",key:"size",type:"object",remark:"渲染器设置宽高，不可编辑，自动获取容器宽高",isShow:!1,isEdit:!1},shadow:{...this.parame,name:"阴影效果",type:"boolean",key:"shadow"}}},this.controls={defaults:{enableDamping:!0,dampingFactor:.05,enableZoom:!0,autoRotate:!1,enableRotate:!0,minDistance:1,maxDistance:80,enablePan:!0,polarAngle:{minPolarAngle:0,maxPolarAngle:180},azimuthAngle:{minAzimuthAngle:null,maxAzimuthAngle:null},target:{x:0,y:0,z:0}},parame:{enableDamping:{...this.parame,name:"动态阻尼",type:"boolean",key:"enableDamping"},dampingFactor:{...this.parame,name:"阻尼系数",type:"number",key:"dampingFactor",min:.01,max:1,step:.01},enablePan:{...this.parame,name:"右键拖拽",type:"boolean",key:"enablePan"},enableZoom:{...this.parame,name:"缩放",type:"boolean",key:"enableZoom"},minDistance:{...this.parame,name:"最近距离",type:"number",key:"minDistance",min:0},maxDistance:{...this.parame,name:"最远距离",type:"number",key:"maxDistance",min:0},autoRotate:{...this.parame,name:"自动旋转",type:"boolean",key:"autoRotate"},enableRotate:{...this.parame,name:"旋转",type:"boolean",key:"enableRotate"},polarAngle:{...this.parame,name:"上下旋转",type:"object",key:"polarAngle",value:{minPolarAngle:{...this.parame,name:"最小值",type:"number",key:"minPolarAngle",min:0,max:180},maxPolarAngle:{...this.parame,name:"最大值",type:"number",key:"maxPolarAngle",min:0,max:180}}},azimuthAngle:{...this.parame,name:"左右旋转",type:"object",key:"azimuthAngle",value:{minAzimuthAngle:{...this.parame,name:"最小值",type:"number",key:"minAzimuthAngle",min:-180,max:180},maxAzimuthAngle:{...this.parame,name:"最大值",type:"number",key:"maxAzimuthAngle",min:-180,max:180}}},target:{...this.parame,name:"目标位置",type:"object",key:"target",flex:!0,value:{x:{...this.parame,name:"x",type:"number",key:"x",step:.01},y:{...this.parame,name:"y",type:"number",key:"y",step:.01},z:{...this.parame,name:"z",type:"number",key:"z",step:.01}}}}},this.meshType={BoxGeometry:{type:"BoxGeometry",name:"立方几何体",defaults:{parameters:{width:1,height:1,depth:1},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{width:{...this.parame,name:"宽度",type:"number",key:"width",step:.1},height:{...this.parame,name:"高度",type:"number",key:"height",step:.1},depth:{...this.parame,name:"深度",type:"number",key:"depth",step:.1}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},PlaneGeometry:{type:"PlaneGeometry",name:"平面几何体",defaults:{parameters:{width:1,height:1},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{width:{...this.parame,name:"宽度",type:"number",key:"width",min:0,step:.1},height:{...this.parame,name:"高度",type:"number",key:"height",min:0,step:.1}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},CircleGeometry:{type:"CircleGeometry",name:"圆形几何体",defaults:{parameters:{radius:.6,segments:64,thetaStart:0,thetaLength:6.3},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{radius:{...this.parame,name:"半径",type:"number",key:"radius",step:.1},segments:{...this.parame,name:"分段数",type:"number",key:"segments",max:128,min:0},thetaStart:{...this.parame,name:"起始角",type:"number",key:"thetaStart",step:.1,min:0,max:6.3},thetaLength:{...this.parame,name:"中心角",type:"number",key:"thetaLength",step:.1,min:0,max:6.3}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},RingGeometry:{type:"RingGeometry",name:"环形几何体",defaults:{parameters:{innerRadius:.3,outerRadius:.6,thetaSegments:64,thetaStart:0,thetaLength:6.3},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{innerRadius:{...this.parame,name:"内部半径",type:"number",key:"innerRadius",step:.1},outerRadius:{...this.parame,name:"外部半径",type:"number",key:"outerRadius",step:.1},thetaSegments:{...this.parame,name:"分段数",type:"number",key:"thetaSegments",max:128,min:0},thetaStart:{...this.parame,name:"起始角",type:"number",key:"thetaStart",step:.1,min:0,max:6.3},thetaLength:{...this.parame,name:"中心角",type:"number",key:"thetaLength",step:.1,min:0,max:6.3}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},ConeGeometry:{type:"ConeGeometry",name:"圆锥几何体",defaults:{parameters:{radius:.6,height:1,radialSegments:64,openEnded:!1,thetaStart:0,thetaLength:6.3},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{radius:{...this.parame,name:"半径",type:"number",key:"radius",step:.1},height:{...this.parame,name:"高度",type:"number",key:"height",step:.1},radialSegments:{...this.parame,name:"分段数",type:"number",key:"radialSegments",max:128,min:0},openEnded:{...this.parame,name:"开放",type:"boolean",key:"openEnded"},thetaStart:{...this.parame,name:"起始角",type:"number",key:"thetaStart",step:.1,min:0,max:6.3},thetaLength:{...this.parame,name:"中心角",type:"number",key:"thetaLength",step:.1,min:0,max:6.3}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},CylinderGeometry:{type:"CylinderGeometry",name:"圆柱几何体",defaults:{parameters:{radiusTop:.6,radiusBottom:.6,height:1,radialSegments:64,openEnded:!1,thetaStart:0,thetaLength:6.3},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{radiusTop:{...this.parame,name:"顶部半径",type:"number",key:"radiusTop",step:.1},radiusBottom:{...this.parame,name:"底部半径",type:"number",key:"radiusBottom",step:.1},height:{...this.parame,name:"高度",type:"number",key:"height",step:.1},radialSegments:{...this.parame,name:"分段数",type:"number",key:"radialSegments",max:128,min:0},openEnded:{...this.parame,name:"开放",type:"boolean",key:"openEnded"},thetaStart:{...this.parame,name:"起始角",type:"number",key:"thetaStart",step:.1,min:0,max:6.3},thetaLength:{...this.parame,name:"中心角",type:"number",key:"thetaLength",step:.1,min:0,max:6.3}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},SphereGeometry:{type:"SphereGeometry",name:"球形几何体",defaults:{parameters:{radius:.6,widthSegments:64,heightSegments:64,phiStart:0,phiLength:6.3,thetaStart:0,thetaLength:3.2},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{radius:{...this.parame,name:"半径",type:"number",key:"radius",step:.1},widthSegments:{...this.parame,name:"水平分段",type:"number",key:"widthSegments",max:128,min:3},heightSegments:{...this.parame,name:"垂直分段",type:"number",key:"heightSegments",max:128,min:2},phiStart:{...this.parame,name:"水平起始",type:"number",key:"phiStart",step:.1,min:0,max:6.3},phiLength:{...this.parame,name:"水平角度",type:"number",key:"phiLength",step:.1,min:0,max:6.3},thetaStart:{...this.parame,name:"垂直起始",type:"number",key:"thetaStart",step:.1,min:0,max:6.3},thetaLength:{...this.parame,name:"垂直角度",type:"number",key:"thetaLength",step:.1,min:0,max:3.2}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},TorusGeometry:{type:"TorusGeometry",name:"环形几何体",defaults:{parameters:{radius:.5,tube:.2,radialSegments:64,tubularSegments:64,arc:6.3},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0,material:null},parame:{parameters:{...this.parame,name:"几何参数",type:"object",key:"parameters",value:{radius:{...this.parame,name:"圆环半径",type:"number",key:"radius",step:.1},tube:{...this.parame,name:"管道半径",type:"number",key:"tube",step:.1},radialSegments:{...this.parame,name:"圆环分段",type:"number",key:"radialSegments",min:3,max:128},tubularSegments:{...this.parame,name:"管道分段",type:"number",key:"tubularSegments",min:3,max:128},arc:{...this.parame,name:"中心角",type:"number",key:"arc",step:.1,min:0,max:6.3}}},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},type:{type:"type",name:"类型",defaults:{},parame:{}}},this.lightType={public:{type:"public",name:"公共属性",defaults:{color:"#fff",visible:!0},parame:{...this.visible,intensity:{...this.parame,name:"光照强度",type:"number",key:"intensity",min:0,max:2,step:.1},color:{...this.parame,name:"光照颜色",key:"color",type:"color"}}},AmbientLight:{type:"AmbientLight",name:"环境光",defaults:{intensity:.8},parame:{}},DirectionalLight:{type:"DirectionalLight",name:"平行光",defaults:{intensity:.2,position:{x:1,y:1,z:5},helper:!0},parame:{position:{...this.transform.position},castShadow:{...this.shadow.castShadow},helper:{...this.parame,name:"辅助对象",type:"boolean",key:"helper"}}},HemisphereLight:{type:"HemisphereLight",name:"半球光",defaults:{intensity:.5,groundColor:"#333",position:{x:0,y:1,z:0},helper:!0},parame:{groundColor:{...this.parame,name:"反面颜色",key:"groundColor",type:"color"},position:{...this.transform.position},helper:{...this.parame,name:"辅助对象",type:"boolean",key:"helper"}}},PointLight:{type:"PointLight",name:"点光源",defaults:{intensity:1,distance:10,decay:1,position:{x:0,y:1,z:0},helper:!0},parame:{distance:{...this.parame,name:"衰退距离",key:"distance",type:"number",min:0},decay:{...this.parame,name:"衰退量",key:"decay",type:"number",min:0,max:2},position:{...this.transform.position},castShadow:{...this.shadow.castShadow},helper:{...this.parame,name:"辅助对象",type:"boolean",key:"helper"}}},RectAreaLight:{type:"RectAreaLight",name:"平面光",defaults:{intensity:1,width:1,height:1,position:{x:0,y:1,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},helper:!0},parame:{width:{...this.parame,name:"宽度",key:"width",type:"number",min:0,step:.1},height:{...this.parame,name:"高度",key:"height",type:"number",min:0,step:.1},...this.transform,helper:{...this.parame,name:"辅助对象",type:"boolean",key:"helper"}}},SpotLight:{type:"SpotLight",name:"聚光灯",defaults:{intensity:1,angle:.5,distance:10,decay:1,penumbra:1,position:{x:0,y:1,z:0},helper:!0},parame:{angle:{...this.parame,name:"散射角度",key:"angle",type:"number",min:0,max:1.5,step:.01},distance:{...this.parame,name:"衰退距离",key:"distance",type:"number",min:0},decay:{...this.parame,name:"衰退量",key:"decay",type:"number",min:0,max:2},penumbra:{...this.parame,name:"半影衰减",key:"penumbra",type:"number",min:0,max:1,step:.01},position:{...this.transform.position},castShadow:{...this.shadow.castShadow},helper:{...this.parame,name:"辅助对象",type:"boolean",key:"helper"}}}},this.lineType={public:{type:"public",name:"公共属性",defaults:{visible:!0},parame:{...this.visible}},LineSegments:{type:"LineSegments",name:"线段",defaults:{color:"#fff",hyPoints:[],hyMouseAdd:!0,position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0}},parame:{color:{...this.parame,name:"线条颜色",type:"color",key:"color"},hyPoints:{...this.parame,name:"顶点",type:"array",key:"hyPoints",isShow:!1},hyMouseAdd:{...this.parame,name:"鼠标添加",type:"boolean",key:"hyMouseAdd"},...this.transform}},Line:{type:"Line",name:"线",defaults:{color:"#fff",hyPoints:[],hyMouseAdd:!0,position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0}},parame:{color:{...this.parame,name:"线条颜色",type:"color",key:"color"},hyPoints:{...this.parame,name:"顶点",type:"array",key:"hyPoints",isShow:!1},hyMouseAdd:{...this.parame,name:"鼠标添加",type:"boolean",key:"hyMouseAdd"},...this.transform}},LineLoop:{type:"LineLoop",name:"环线",defaults:{color:"#fff",hyPoints:[],hyMouseAdd:!0,position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0}},parame:{color:{...this.parame,name:"线条颜色",type:"color",key:"color"},hyPoints:{...this.parame,name:"顶点",type:"array",key:"hyPoints",isShow:!1},hyMouseAdd:{...this.parame,name:"鼠标添加",type:"boolean",key:"hyMouseAdd"},...this.transform}},ConvexGeometry:{type:"ConvexGeometry",name:"围栏",defaults:{hyPoints:[],hyMouseAdd:!0,material:null,position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0}},parame:{hyPoints:{...this.parame,name:"顶点",type:"array",key:"hyPoints",isShow:!1},hyMouseAdd:{...this.parame,name:"鼠标添加",type:"boolean",key:"hyMouseAdd"},material:{...this.parame,name:"材质",type:"material",key:"material"},...this.transform}}},this.helperType={public:{type:"public",name:"公共属性",defaults:{visible:!0},parame:{...this.visible}},GridHelper:{type:"GridHelper",name:"坐标格辅助",defaults:{size:100,divisions:100,colorCenterLine:"#444",colorGrid:"#888"},parame:{size:{...this.parame,name:"尺寸",type:"number",key:"size",step:1,min:1},divisions:{...this.parame,name:"细分次数",type:"number",key:"divisions",step:1,min:1},colorCenterLine:{...this.parame,name:"中线颜色",key:"colorCenterLine",type:"color"},colorGrid:{...this.parame,name:"网格颜色",key:"colorGrid",type:"color"}}},PolarGridHelper:{type:"PolarGridHelper",name:"极坐标格辅助",defaults:{radius:10,radials:8,circles:8,divisions:64,color1:"#444",color2:"#888"},parame:{radius:{...this.parame,name:"半径",type:"number",key:"radius",step:1,min:1},radials:{...this.parame,name:"辐射线数",type:"number",key:"radials",step:1,min:2},circles:{...this.parame,name:"圆圈数量",type:"number",key:"circles",step:1,min:1},divisions:{...this.parame,name:"圆圈分段",type:"number",key:"divisions",step:1,min:3},color1:{...this.parame,name:"颜色1",key:"color1",type:"color"},color2:{...this.parame,name:"颜色2",key:"color2",type:"color"}}}},this.model={defaults:{emissive:!1,hyAnimation:{type:null,isPlay:!1},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0},parame:{url:{...this.parame,name:"模型路径",type:"string",key:"url",isShow:!1},mtl:{...this.parame,name:"mtl材质",type:"string",key:"mtl",isShow:!1},emissive:{...this.parame,name:"自发光",type:"boolean",key:"emissive"},hyAnimation:{...this.parame,name:"动画",type:"object",key:"hyAnimation",isShow:!1,value:{type:{...this.parame,name:"类型",type:"select",key:"type",list:[{name:"111",value:"111"},{name:"222",value:"222"}]},isPlay:{...this.parame,name:"播放",type:"boolean",key:"isPlay"}}},...this.transform,...this.visible,...this.shadow}},this.group={defaults:{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0},parame:{...this.transform,...this.visible}},this.sprite={defaults:{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},material:null,visible:!0},parame:{...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible}},this.text={defaults:{text:"文本",parameters:{size:1,height:.15,curveSegments:12,bevelEnabled:!0,bevelThickness:.02,bevelSize:.02,bevelSegments:10},fontUrl:"/fonts/HarmonyOSHans_Regular.json",position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},material:null,visible:!0},parame:{text:{...this.parame,name:"文本",type:"string",key:"text"},parameters:{...this.parame,name:"文本参数",type:"object",key:"parameters",value:{size:{...this.parame,name:"大小",type:"number",key:"size",step:.01},height:{...this.parame,name:"深度",type:"number",key:"height",step:.01},curveSegments:{...this.parame,name:"分段数",type:"number",key:"curveSegments",step:1},bevelEnabled:{...this.parame,name:"是否斜角",type:"boolean",key:"bevelEnabled"},bevelThickness:{...this.parame,name:"斜角深度",type:"number",key:"bevelThickness",step:.01},bevelSize:{...this.parame,name:"延伸距离",type:"number",key:"bevelSize",step:.01},bevelSegments:{...this.parame,name:"斜角分段",type:"number",key:"bevelSegments",step:1}}},fontUrl:{...this.parame,name:"字体路径",type:"string",key:"fontUrl",isShow:!1},...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}},this.spriteText={defaults:{text:"标签文本",fontSize:50,textAlign:"center",textBaseline:"middle",fillStyle:"#fff",haveStroke:!0,strokeStyle:"#000",position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},visible:!0},parame:{text:{...this.parame,name:"文本",type:"string",key:"text"},fontSize:{...this.parame,name:"字体大小",type:"number",key:"fontSize",max:300,min:1},textAlign:{...this.parame,name:"textAlign",type:"string",key:"textAlign",isShow:!1},textBaseline:{...this.parame,name:"textBaseline",type:"string",key:"textBaseline",isShow:!1},fillStyle:{...this.parame,name:"字体颜色",key:"fillStyle",type:"color"},haveStroke:{...this.parame,name:"轮廓",type:"boolean",key:"haveStroke"},strokeStyle:{...this.parame,name:"轮廓颜色",key:"strokeStyle",type:"color"},...this.transform,...this.visible}},this.mergeMesh={defaults:{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0},material:null,visible:!0},parame:{...this.transform,material:{...this.parame,name:"材质",type:"material",key:"material"},...this.visible,...this.shadow}}}createScene(){let e={uuid:this.tools.createUUID(),name:"场景",type:"Scene",params:[],children:[]};return Object.keys(this.publicParame).forEach((t=>{let a={...this.publicParame[t]};a.value=e[t],e.params.push(a)})),Object.keys(this.scene.parame).forEach((t=>{let a={...this.scene.parame[t]};a.isEdit&&(a.value=this.scene.defaults[t]),e.params.push(a)})),e}createCamera(e){let t={uuid:this.tools.createUUID(),name:"相机",type:"Camera",isDefault:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.camera.parame).forEach((e=>{let a=this.tools.deepClone(this.camera.parame[e]);"isDefault"===a.key?a.value=t[e]:a.isEdit&&("object"!==a.type?a.value=this.camera.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.camera.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createRenderer(){let e={uuid:this.tools.createUUID(),name:"渲染器",type:"Renderer",params:[]};return Object.keys(this.publicParame).forEach((t=>{let a={...this.publicParame[t]};a.value=e[t],e.params.push(a)})),Object.keys(this.renderer.parame).forEach((t=>{let a={...this.renderer.parame[t]};a.isEdit&&("object"!==a.type?a.value=this.renderer.defaults[t]:Object.keys(a.value).forEach((e=>{let i={...a.value[e]};i.isEdit&&(i.value=this.renderer.defaults[t][e]),a.value[e]={...i}}))),e.params.push(a)})),e}createControls(){let e={uuid:this.tools.createUUID(),name:"控制器",type:"Controls",params:[]};return Object.keys(this.publicParame).forEach((t=>{let a={...this.publicParame[t]};a.value=e[t],e.params.push(a)})),Object.keys(this.controls.parame).forEach((t=>{let a={...this.controls.parame[t]};a.isEdit&&("object"!==a.type?a.value=this.controls.defaults[t]:Object.keys(a.value).forEach((e=>{let i={...a.value[e]};i.isEdit&&(i.value=this.controls.defaults[t][e]),a.value[e]={...i}}))),e.params.push(a)})),e}createMesh(e){let t={uuid:this.tools.createUUID(),name:this.meshType[e].name,type:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.meshType[e].parame).forEach((a=>{let i=this.tools.deepClone(this.meshType[e].parame[a]);i.isEdit&&("object"!==i.type?i.value=this.meshType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};(s.isEdit||"parameters"==i.key)&&(s.value=this.meshType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),t}createLight(e){let t={uuid:this.tools.createUUID(),name:this.lightType[e].name,type:e,params:[]};Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)}));return Object.keys(this.lightType.public.parame).forEach((a=>{let i=this.tools.deepClone(this.lightType.public.parame[a]);i.isEdit&&("object"!==i.lightPublicParame?i.value=void 0!==this.lightType.public.defaults[a]?this.lightType.public.defaults[a]:this.lightType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=void 0!==this.lightType.public.defaults[a][t]?this.lightType.public.defaults[a][t]:this.lightType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),Object.keys(this.lightType[e].parame).forEach((a=>{let i=this.tools.deepClone(this.lightType[e].parame[a]);i.isEdit&&("object"!==i.type?i.value=this.lightType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=this.lightType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),t}createLine(e){let t={uuid:this.tools.createUUID(),name:this.lineType[e].name,type:e,params:[]};Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)}));return Object.keys(this.lineType.public.parame).forEach((a=>{let i=this.tools.deepClone(this.lineType.public.parame[a]);i.isEdit&&("object"!==i.linePublicParame?i.value=void 0!==this.lineType.public.defaults[a]?this.lineType.public.defaults[a]:this.lineType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=void 0!==this.lineType.public.defaults[a][t]?this.lineType.public.defaults[a][t]:this.lineType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),Object.keys(this.lineType[e].parame).forEach((a=>{let i=this.tools.deepClone(this.lineType[e].parame[a]);i.isEdit&&("object"!==i.type?"array"===i.type?i.value=this.tools.deepClone(this.lineType[e].defaults[a]):i.value=this.lineType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=this.lineType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),t}createHelper(e){let t={uuid:this.tools.createUUID(),name:this.helperType[e].name,type:e,params:[]};Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)}));return Object.keys(this.helperType.public.parame).forEach((a=>{let i=this.tools.deepClone(this.helperType.public.parame[a]);i.isEdit&&("object"!==i.helperPublicParame?i.value=void 0!==this.helperType.public.defaults[a]?this.helperType.public.defaults[a]:this.helperType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=void 0!==this.helperType.public.defaults[a][t]?this.helperType.public.defaults[a][t]:this.helperType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),Object.keys(this.helperType[e].parame).forEach((a=>{let i=this.tools.deepClone(this.helperType[e].parame[a]);i.isEdit&&("object"!==i.type?i.value=this.helperType[e].defaults[a]:Object.keys(i.value).forEach((t=>{let s={...i.value[t]};s.isEdit&&(s.value=this.helperType[e].defaults[a][t]),i.value[t]={...s}}))),t.params.push(i)})),t}createModel(e){let t={uuid:this.tools.createUUID(),name:e.name,type:e.type,url:e.url,mtl:e.mtl,first:!0,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.model.parame).forEach((a=>{let i=this.tools.deepClone(this.model.parame[a]);i.isEdit&&("object"!==i.type?(i.value=this.model.defaults[a],"url"==a&&(i.value=e.url)):Object.keys(i.value).forEach((e=>{let t={...i.value[e]};t.isEdit&&(t.value=this.model.defaults[a][e]),i.value[e]={...t}}))),t.params.push(i)})),t}createGroup(e){let t={uuid:this.tools.createUUID(),name:"分组",type:e,params:[],children:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.group.parame).forEach((e=>{let a=this.tools.deepClone(this.group.parame[e]);a.isEdit&&("object"!==a.type?a.value=this.group.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.group.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createSprite(e){let t={uuid:this.tools.createUUID(),name:"精灵",type:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.sprite.parame).forEach((e=>{let a=this.tools.deepClone(this.sprite.parame[e]);a.isEdit&&("object"!==a.type?a.value=this.sprite.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.sprite.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createText(e){let t={uuid:this.tools.createUUID(),name:"文本",type:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.text.parame).forEach((e=>{let a=this.tools.deepClone(this.text.parame[e]);a.isEdit&&("object"!==a.type?a.value=this.text.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.text.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createSpriteText(e){let t={uuid:this.tools.createUUID(),name:"标签文本",type:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.spriteText.parame).forEach((e=>{let a=this.tools.deepClone(this.spriteText.parame[e]);a.isEdit&&("object"!==a.type?a.value=this.spriteText.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.spriteText.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createMergeMesh(e){let t={uuid:this.tools.createUUID(),name:"网格对象",type:"MergeMesh",child:e,params:[]};return Object.keys(this.publicParame).forEach((e=>{let a={...this.publicParame[e]};a.value=t[e],t.params.push(a)})),Object.keys(this.mergeMesh.parame).forEach((e=>{let a=this.tools.deepClone(this.mergeMesh.parame[e]);a.isEdit&&("object"!==a.type?a.value=this.mergeMesh.defaults[e]:Object.keys(a.value).forEach((t=>{let i={...a.value[t]};i.isEdit&&(i.value=this.mergeMesh.defaults[e][t]),a.value[t]={...i}}))),t.params.push(a)})),t}createEvent(e){let t={uuid:this.tools.createUUID(),name:e.name,listener:e.listener,custom:e.custom};return this.tools.deepClone(t)}}var L=a(80580),P=a(57911),E=a.n(P),j={name:"AddMaterialModal",props:{typeList:{type:Array,default(){return[]}}},data(){return{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,mdl:{},form:this.$form.createForm(this),permissions:[],treeCheck:!1,pidSet:[],list:[],title:"保存材质"}},created(){},methods:{add(){this.form.resetFields(),this.edit({})},edit(e){this.mdl={imageUrl:e.map.url,name:"",parameter:JSON.stringify(e),type:"1"},this.visible=!0,this.$nextTick((()=>{this.form.setFieldsValue(E()(this.mdl,"name"))}))},handleOk(){const e=this;this.form.validateFields(((t,a)=>{if(!t){e.confirmLoading=!0;this.mdl}}))},handleCancel(){this.visible=!1}}},G=a(1001),O=(0,G.Z)(j,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:400,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"材质分类"}},[t("a-select",{staticStyle:{width:"120px"},model:{value:e.mdl.type,callback:function(t){e.$set(e.mdl,"type",t)},expression:"mdl.type"}},e._l(e.typeList,(function(a){return t("a-select-option",{key:a.code,attrs:{value:a.code}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"材质名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入材质名称"}]}],expression:"['name', { rules: [{ required: true, message: '请输入材质名称' }] }]"}],attrs:{placeholder:"材质名称"}})],1)],1)],1)}),[],!1,null,"acc71ed8",null).exports,_={name:"MaterialModal",components:{"chrome-picker":L.Chrome,AddMaterialModal:O},data(){return{colorPicker:{style:{display:"none"},value:"#fff",isOpen:!1},uploadUrl:"/api1",upData:{typeName:"model/Material"},visible:!1,confirmLoading:!1,labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:17}},bodyStyle:{padding:"15px"},title:"编辑材质",sideList:[{name:"正面",value:"FrontSide"},{name:"背面",value:"BackSide"},{name:"双面",value:"DoubleSide"}],defaults:{side:"DoubleSide",color:"#fff",roughness:.6,metalness:.2,wireframe:!1,transparent:!1,opacity:1,map:{url:"",wrapS:"RepeatWrapping",wrapT:"RepeatWrapping",repeatX:1,repeatY:1},bumpMap:{url:"",wrapS:"RepeatWrapping",wrapT:"RepeatWrapping",repeatX:1,repeatY:1},alphaMap:{url:"",wrapS:"RepeatWrapping",wrapT:"RepeatWrapping",repeatX:1,repeatY:1},roughnessMap:{url:"",wrapS:"RepeatWrapping",wrapT:"RepeatWrapping",repeatX:1,repeatY:1},metalnessMap:{url:"",wrapS:"RepeatWrapping",wrapT:"RepeatWrapping",repeatX:1,repeatY:1}},material:{side:{name:"边",type:"select",key:"side",value:null},color:{name:"颜色",type:"color",key:"color",value:null},roughness:{name:"粗糙度",type:"number",key:"roughness",min:0,max:1,step:.1,value:null},metalness:{name:"金属度",type:"number",key:"metalness",min:0,max:1,step:.1,value:null},wireframe:{name:"线框",type:"boolean",key:"wireframe",value:null},transparent:{name:"透明",type:"boolean",key:"transparent",value:null},opacity:{name:"透明度",type:"number",key:"opacity",min:0,max:1,step:.1,value:null},map:{name:"颜色贴图",type:"map",key:"map",value:null},bumpMap:{name:"凹凸贴图",type:"map",key:"bumpMap",value:null},alphaMap:{name:"透明贴图",type:"map",key:"alphaMap",value:null},roughnessMap:{name:"粗糙贴图",type:"map",key:"roughnessMap",value:null},metalnessMap:{name:"金属贴图",type:"map",key:"metalnessMap",value:null}},params:{},materialTypeList:[]}},created(){this.getMaterialTypeList()},methods:{getMaterialTypeList(){},add(){this.edit({})},edit(e){let t=this.deepClone(this.defaults);this.params={...t,...e},Object.keys(this.material).forEach((e=>{this.material[e].value=this.params[e]})),this.visible=!0},handleOk(){Object.keys(this.material).forEach((e=>{this.params[e]=this.material[e].value})),this.$emit("ok",this.params),this.closeColorPicker(),this.visible=!1},handleCancel(){this.closeColorPicker(),this.visible=!1},changeMaterialType(e){e&&this.getMaterialList(e)},getMaterialList(e){},save(){Object.keys(this.material).forEach((e=>{this.params[e]=this.material[e].value})),this.params.map&&this.$refs.addMaterialModal.edit(this.params)},addOK(e){this.getMaterialList(e)},changeMaterial(e){let t=JSON.parse(e.parameter);this.params=t,Object.keys(t).forEach((e=>{"map"==e&&"string"==typeof this.params[e]?(this.material[e].value.url=this.params[e],this.material[e].value.repeatX=1,this.material[e].value.repeatY=1):this.material[e].value=this.params[e]}))},draggerReject(){this.$message.error("文件类型错误")},handleChange(e,t){if("done"==e.file.status){const a=e.file.response;200==a.code?t.value.url=a.data.img:this.$message.error(a.msg)}else"error"==e.file.status&&this.$message.error("上传失败")},del(e){const t=this;this.$confirm({title:`确定删除“${e.name}”？`,content:"此操作不可逆，请谨慎操作！",okText:"删除",okType:"danger",cancelText:"取消",onOk(){t.delMaterial(e)}})},delMaterial(e){},updateColor(e){this.colorPicker.item.value=e.hex},changeColorPicker(e,t){const a=t.clientX,i=t.clientY;this.colorPicker.item&&this.colorPicker.item.key===e.key?this.colorPicker.isOpen=!this.colorPicker.isOpen:this.colorPicker.isOpen=!0,this.colorPicker.value=e.value,this.colorPicker.item=e,this.colorPicker.style={left:`${a}px`,top:`${i}px`,display:this.colorPicker.isOpen?"block":"none"},t.stopPropagation()},closeColorPicker(){this.colorPicker.isOpen=!1,this.colorPicker.style.display="none"},deepClone(e){return JSON.parse(JSON.stringify(e))}}},z=(0,G.Z)(_,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:610,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,bodyStyle:e.bodyStyle,cancelText:"取消",okText:"确定"},on:{ok:e.handleOk,cancel:e.handleCancel}},[e.materialTypeList.length?t("div",{staticClass:"top"},[t("a-button",{staticStyle:{"margin-left":"0px"},on:{click:e.save}},[e._v("保存材质")])],1):e._e(),t("div",{staticClass:"flex"},[e.materialTypeList.length?t("div",{staticClass:"material-library"},[e.materialTypeList.length?t("a-collapse",{attrs:{"default-active-key":"1",bordered:!1,accordion:!0},on:{change:e.changeMaterialType}},e._l(e.materialTypeList,(function(a){return t("a-collapse-panel",{key:a.code,attrs:{header:a.name}},[a.materialList.length?e._e():t("p",{staticClass:"text-center"},[e._v("暂无材质")]),a.materialList.length?t("div",{staticClass:"material-list"},e._l(a.materialList,(function(a){return t("div",{key:a.id,staticClass:"material-item",on:{click:function(t){return e.changeMaterial(a)}}},[t("div",{staticClass:"material-img",style:{"background-image":`url(${a.imageUrl})`}},[a.imageUrl?e._e():t("a-icon",{style:{fontSize:"40px",color:"#555"},attrs:{type:"file-image"}}),t("a-icon",{style:{fontSize:"16px",color:"#F44336",position:"absolute",right:"5px",top:"5px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.del(a)}}})],1),t("div",{staticClass:"material-name"},[e._v(e._s(a.name))])])})),0):e._e()])})),1):e._e()],1):e._e(),t("div",{staticClass:"material-info",on:{click:e.closeColorPicker}},e._l(e.material,(function(a){return t("div",{key:a.key,staticClass:"obj-item"},[t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:a.name}},["number"==a.type?t("a-input-number",{attrs:{min:a.min,max:a.max,step:a.step},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"string"==a.type?t("a-input",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"boolean"==a.type?t("a-switch",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"select"==a.type?t("a-select",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}},e._l(e.sideList,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.name)+" ")])})),1):e._e(),"color"==a.type?t("div",{staticClass:"color-picker-btn",on:{click:function(t){return e.changeColorPicker(a,t)}}},[t("div",{staticClass:"color-show",style:{backgroundColor:a.value}},[t("a-icon",{staticClass:"color-icon",attrs:{type:"swap"}})],1)]):e._e(),"map"==a.type?t("a-input",{model:{value:a.value.url,callback:function(t){e.$set(a.value,"url",t)},expression:"i.value.url"}}):e._e(),"map"==a.type&&a.value.url?t("div",{staticClass:"dragger-box flex"},[t("div",{staticClass:"img-box",style:{"background-image":`url(${a.value.url})`}}),t("div",{staticClass:"map-attr"},[t("div",{staticStyle:{"padding-left":"5px"}},[e._v("重复次数")]),t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"x"}},[t("a-input-number",{attrs:{min:"1",step:"1"},model:{value:a.value.repeatX,callback:function(t){e.$set(a.value,"repeatX",t)},expression:"i.value.repeatX"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"y"}},[t("a-input-number",{attrs:{min:"1",step:"1"},model:{value:a.value.repeatY,callback:function(t){e.$set(a.value,"repeatY",t)},expression:"i.value.repeatY"}})],1)],1)]):e._e(),"map"!=a.type||a.value.url?e._e():t("div",{staticClass:"dragger-box"},[t("a-upload-dragger",{attrs:{accept:"image/*",name:"file",action:e.uploadUrl,data:e.upData,showUploadList:!1},on:{change:function(t){return e.handleChange(t,a)},reject:e.draggerReject}},[t("p",{staticClass:"ant-upload-drag-icon"},[t("a-icon",{attrs:{type:"inbox"}})],1),t("p",{staticClass:"ant-upload-text",staticStyle:{"font-size":"12px"}},[e._v("单击或将图片拖到此区域以上传")])])],1)],1)],1)})),0)]),t("div",{staticClass:"color-picker",style:e.colorPicker.style},[t("chrome-picker",{on:{input:e.updateColor},model:{value:e.colorPicker.value,callback:function(t){e.$set(e.colorPicker,"value",t)},expression:"colorPicker.value"}})],1),t("AddMaterialModal",{ref:"addMaterialModal",attrs:{typeList:e.materialTypeList},on:{ok:e.addOK}})],1)}),[],!1,null,"0e9d2705",null).exports,R={name:"AddModelModal",props:{typeList:{type:Array,default(){return[]}}},data(){return{uploadUrl:"/api1",upData:{typeName:"model/Model"},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,mdl:{},form:this.$form.createForm(this),list:[],title:"保存模型"}},created(){},methods:{add(){this.form.resetFields(),this.edit({})},edit(e){this.mdl={imageUrl:"",name:e.name,parameter:JSON.stringify(e),type:"1"},this.visible=!0,this.$nextTick((()=>{this.form.setFieldsValue(E()(this.mdl,"name"))}))},handleOk(){const e=this;this.form.validateFields(((t,a)=>{if(!t){e.confirmLoading=!0;this.mdl}}))},handleCancel(){this.visible=!1},handleChange(e){if("done"==e.file.status){const t=e.file.response;200==t.code?this.mdl.imageUrl=t.data.img:this.$message.error(t.msg)}else"error"==e.file.status&&this.$message.error("上传失败")},draggerReject(){this.$message.error("文件类型错误")}}},N={name:"ModelModal",components:{AddModelModal:(0,G.Z)(R,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:400,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"模型分类"}},[t("a-select",{staticStyle:{width:"120px"},model:{value:e.mdl.type,callback:function(t){e.$set(e.mdl,"type",t)},expression:"mdl.type"}},e._l(e.typeList,(function(a){return t("a-select-option",{key:a.code,attrs:{value:a.code}},[e._v(" "+e._s(a.name)+" ")])})),1)],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"模型名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入模型名称"}]}],expression:"['name', { rules: [{ required: true, message: '请输入模型名称' }] }]"}],attrs:{placeholder:"模型名称"}})],1),t("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"模型图片"}},[t("a-input",{attrs:{placeholder:"模型图片"},model:{value:e.mdl.imageUrl,callback:function(t){e.$set(e.mdl,"imageUrl",t)},expression:"mdl.imageUrl"}})],1),e.mdl.imageUrl?t("div",{staticClass:"dragger-box"},[t("div",{staticClass:"img-box",style:{"background-image":`url(${e.mdl.imageUrl})`}})]):e._e(),e.mdl.imageUrl?e._e():t("div",{staticClass:"dragger-box"},[t("a-upload-dragger",{attrs:{accept:"image/*",name:"file",action:e.uploadUrl,data:e.upData,showUploadList:!1},on:{change:e.handleChange,reject:e.draggerReject}},[t("p",{staticClass:"ant-upload-drag-icon"},[t("a-icon",{attrs:{type:"inbox"}})],1),t("p",{staticClass:"ant-upload-text"},[e._v("单击或将图片拖到此区域以上传")])])],1)],1)],1)}),[],!1,null,"a509118c",null).exports},data(){return{uploadUrl:"/api1",upData:{typeName:"model/Model"},visible:!1,confirmLoading:!1,labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:17}},bodyStyle:{padding:"15px"},title:"添加模型",modelList:[{name:"glb模型",value:"GlbModel"},{name:"gltf模型",value:"GltfModel"},{name:"json模型",value:"JsonModel"},{name:"obj模型",value:"ObjModel"},{name:"dae模型",value:"DaeModel"},{name:"fbx模型",value:"FbxModel"}],defaults:{name:"3D模型",type:"GlbModel",url:"",mtl:""},material:{name:{name:"名称",type:"string",key:"name",value:null,isShow:!0},type:{name:"类型",type:"select",key:"type",value:null,isShow:!0},url:{name:"模型",type:"file",key:"url",value:null,isShow:!0},mtl:{name:"mtl材质",type:"file",key:"mtl",value:null,isShow:!1}},params:{},modelTypeList:[],parentUUID:null,isNewModel:!1,typeLimit:"glb"}},created(){this.getModelTypeList()},methods:{getModelTypeList(){this.newModel()},add(e){this.parentUUID=e,this.edit({})},edit(e){this.params={...this.defaults,...e},Object.keys(this.material).forEach((e=>{this.material[e].value=this.params[e]})),this.visible=!0},handleOk(){Object.keys(this.material).forEach((e=>{this.params[e]=this.material[e].value})),this.params.url&&(this.$emit("ok",this.params,this.parentUUID),this.visible=!1)},handleCancel(){this.visible=!1},changeMaterialType(e){e&&this.getModelList(e)},getModelList(e){},save(){Object.keys(this.material).forEach((e=>{this.params[e]=this.material[e].value})),this.params.url&&this.$refs.addModelModal.edit(this.params)},addOK(e){this.getModelList(e)},changeMaterial(e){let t=JSON.parse(e.parameter);this.params=t,Object.keys(this.material).forEach((e=>{this.material[e].value=this.params[e],"type"==e&&(this.setTypeLimit(this.material[e].value),"ObjModel"==this.material[e].value?this.material.mtl.isShow=!0:this.material.mtl.isShow=!1)})),this.isNewModel||this.handleOk()},draggerReject(){this.$message.error("文件格式不支持")},handleChange(e,t){if("done"==e.file.status){const a=e.file.response;200==a.code?t.value=a.data.file:this.$message.error(a.msg)}else"error"==e.file.status&&this.$message.error("上传失败")},beforeUpload(e){return!(!/glb$/.test(e.name)&&!/gltf$/.test(e.name))||(!!/json$/.test(e.name)||(this.$message.error("仅支持glb、gltf、json文件"),!1))},del(e){const t=this;this.$confirm({title:`确定删除“${e.name}”？`,content:"此操作不可逆，请谨慎操作！",okText:"删除",okType:"danger",cancelText:"取消",onOk(){t.delModel(e)}})},delModel(e){},newModel(){this.isNewModel=!this.isNewModel},selectChange(e){"type"==e.key&&(this.setTypeLimit(e.value),"ObjModel"==e.value?this.material.mtl.isShow=!0:(this.material.mtl.isShow=!1,this.material.mtl.value=""))},setTypeLimit(e){let t=null;switch(e){case"GlbModel":t="glb";break;case"GltfModel":t="gltf";break;case"JsonModel":t="json";break;case"ObjModel":t="obj";break;case"DaeModel":t="dae";break;case"FbxModel":t="fbx"}this.typeLimit=t}}},A=(0,G.Z)(N,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:610,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,bodyStyle:e.bodyStyle,cancelText:"取消",okText:"确定"},on:{ok:e.handleOk,cancel:e.handleCancel}},[e.modelTypeList.length?t("div",{staticClass:"top"},[e.isNewModel?t("a-button",{staticStyle:{"margin-left":"0px"},on:{click:e.save}},[e._v("保存模型")]):e._e(),t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.newModel}},[e._v(e._s(e.isNewModel?"取消导入":"导入模型"))])],1):e._e(),t("div",{staticClass:"content"},[e.modelTypeList.length?t("div",{staticClass:"material-library"},[e.modelTypeList.length?t("a-collapse",{attrs:{"default-active-key":"1",bordered:!1,accordion:!0},on:{change:e.changeMaterialType}},e._l(e.modelTypeList,(function(a){return t("a-collapse-panel",{key:a.code,attrs:{header:a.name}},[a.materialList.length?e._e():t("p",{staticClass:"text-center"},[e._v("暂无模型")]),a.materialList.length?t("div",{staticClass:"material-list"},[e._l(a.materialList,(function(a){return t("div",{key:a.id,staticClass:"material-item",on:{click:function(t){return e.changeMaterial(a)}}},[t("div",{staticClass:"material-img",style:{"background-image":`url(${a.imageUrl})`}},[a.imageUrl?e._e():t("a-icon",{style:{fontSize:"48px",color:"#555"},attrs:{type:"inbox"}}),t("a-icon",{style:{fontSize:"16px",color:"#F44336",position:"absolute",right:"5px",top:"5px"},attrs:{type:"close-circle"},on:{click:function(t){return t.stopPropagation(),e.del(a)}}})],1),t("div",{staticClass:"material-name"},[e._v(e._s(a.name))])])})),e.isNewModel||a.materialList.length%4!=2?e._e():t("div",{staticStyle:{width:"120px"}}),!e.isNewModel&&a.materialList.length%4>1?t("div",{staticStyle:{width:"120px"}}):e._e()],2):e._e()])})),1):e._e()],1):e._e(),e.isNewModel?t("div",{staticClass:"material-info"},e._l(e.material,(function(a){return t("div",{key:a.key,staticClass:"obj-item"},[a.isShow?t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:a.name}},["number"==a.type?t("a-input-number",{attrs:{min:a.min,max:a.max,step:a.step},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"string"==a.type?t("a-input",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"boolean"==a.type?t("a-switch",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"select"==a.type?t("a-select",{on:{change:function(t){return e.selectChange(a)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}},e._l(e.modelList,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.name)+" ")])})),1):e._e(),"file"==a.type?t("a-input",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"file"!=a.type||a.value?e._e():t("div",{staticClass:"dragger-box"},[t("a-upload-dragger",{attrs:{accept:"url"==a.key?"."+e.typeLimit:".mtl",name:"file",action:e.uploadUrl,data:e.upData,showUploadList:!1},on:{change:function(t){return e.handleChange(t,a)},reject:e.draggerReject}},[t("p",{staticClass:"ant-upload-drag-icon"},[t("a-icon",{attrs:{type:"inbox"}})],1),t("p",{staticClass:"ant-upload-text",staticStyle:{"font-size":"12px"}},[e._v("单击或将文件拖到此区域以上传")]),t("p",{staticClass:"tips"},[e._v(e._s("url"==a.key?"仅支持"+e.typeLimit+"文件":"仅支持mtl文件"))])])],1)],1):e._e()],1)})),0):e._e()]),t("AddModelModal",{ref:"addModelModal",attrs:{typeList:e.modelTypeList},on:{ok:e.addOK}})],1)}),[],!1,null,"a88d99b6",null).exports,I={name:"PreviewModal",props:{typeList:{type:Array,default(){return[]}}},data(){return{bodyStyle:{padding:"0"},dialogStyle:{top:"0",padding:"0"},title:"预览",visible:!1,propNode:null,hyThree:null,id:"123"}},created(){},methods:{open(e,t){this.hyThree=new C,this.id=this.hyThree.createUUID(),this.propNode=e,this.visible=!0,setTimeout((()=>{this.hyThree.setEngineMode(t),this.hyThree.setClickCallback(this.clickNode),this.hyThree.setDblclickCallback(this.dblclickNode),this.hyThree.init(this.id,e),this.title="预览 | "+this.propNode[0].name}),10)},clickNode(e,t){this.$message.success(t.custom)},dblclickNode(e,t){this.$message.success(t.custom)},handleCancel(){this.visible=!1,this.title="预览",this.propNode&&(this.hyThree.stop(),this.hyThree=null)}}},H=(0,G.Z)(I,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:"100%",visible:e.visible,maskClosable:!1,bodyStyle:e.bodyStyle,dialogStyle:e.dialogStyle,footer:null,wrapClassName:"full-modal"},on:{cancel:e.handleCancel}},[t("div",{staticClass:"flex",attrs:{id:e.id}})])}),[],!1,null,"925d7fc0",null).exports,D={name:"EventModal",components:{},data(){return{visible:!1,confirmLoading:!1,labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:17}},bodyStyle:{padding:"15px"},title:"添加事件",listenerList:[{name:"点击",value:"click"},{name:"双击",value:"dblclick"}],defaults:{name:"点击事件",listener:"click",custom:""},material:{name:{name:"事件名称",type:"string",key:"name",value:null},listener:{name:"监听类型",type:"select",key:"listener",value:null},custom:{name:"自定义参数",type:"string",key:"custom",value:null}},params:{},uuid:null}},created(){},methods:{add(e){this.uuid=e,this.edit({})},edit(e){this.params={...this.defaults,...e},Object.keys(this.material).forEach((e=>{this.material[e].value=this.params[e]})),this.visible=!0},handleOk(){Object.keys(this.material).forEach((e=>{this.params[e]=this.material[e].value})),this.$emit("ok",this.params,this.uuid),this.visible=!1,this.uuid=null},handleCancel(){this.visible=!1,this.uuid=null}}},U=(0,G.Z)(D,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:610,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,bodyStyle:e.bodyStyle,cancelText:"取消",okText:"确定"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("div",{staticClass:"content"},[t("div",{staticClass:"material-info"},e._l(e.material,(function(a){return t("div",{key:a.key,staticClass:"obj-item"},[t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:a.name}},["number"==a.type?t("a-input-number",{attrs:{min:a.min,max:a.max,step:a.step},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"string"==a.type?t("a-input",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"boolean"==a.type?t("a-switch",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}}):e._e(),"select"==a.type?t("a-select",{model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"i.value"}},e._l(e.listenerList,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.name)+" ")])})),1):e._e()],1)],1)})),0)])])}),[],!1,null,"64c40924",null).exports,B={name:"ThreeEditModal",components:{"chrome-picker":L.Chrome,MaterialModal:z,ModelModal:A,PreviewModal:H,EventModal:U},data(){return{colorPicker:{style:{display:"none"},value:"#fff",isOpen:!1},labelCol2:{xs:{span:24},sm:{span:6}},wrapperCol2:{xs:{span:24},sm:{span:17}},title:"",visible:!1,bodyStyle:{padding:"10px"},dialogStyle:{top:"0",padding:"0"},mdl:{},fileList:[],hyThree:null,selectedKeys:[],editNode:{params:[]},replaceFields:{children:"children",title:"name",key:"uuid"},propNode:null,NodeTreeItem:null,isShowStats:!1,controlsMode:[{type:"translate",title:"移动"},{type:"rotate",title:"旋转"},{type:"scale",title:"缩放"}],materialPicker:{},eventIndex:0,quickList:[{type:"addMesh",name:"添加网格对象",icon:"mesh",subMenu:[{type:"BoxGeometry",name:"立方几何体"},{type:"PlaneGeometry",name:"平面几何体"},{type:"CircleGeometry",name:"圆形几何体"},{type:"RingGeometry",name:"环形几何体"},{type:"ConeGeometry",name:"圆锥几何体"},{type:"CylinderGeometry",name:"圆柱几何体"},{type:"SphereGeometry",name:"球形几何体"},{type:"TorusGeometry",name:"圆环几何体"}]},{type:"addLight",name:"添加灯光",icon:"light",subMenu:[{type:"AmbientLight",name:"环境光"},{type:"DirectionalLight",name:"平行光"},{type:"HemisphereLight",name:"半球光"},{type:"PointLight",name:"点光源"},{type:"RectAreaLight",name:"平面光"},{type:"SpotLight",name:"聚光灯"}]},{type:"addSprite",name:"添加精灵",icon:"sprite"},{type:"addText",name:"添加文本",icon:"text",subMenu:[{type:"addText",name:"3D文本"},{type:"spriteText",name:"标签文本"}]},{type:"addLine",name:"添加线",icon:"line",subMenu:[{type:"LineSegments",name:"线段"},{type:"Line",name:"线"},{type:"LineLoop",name:"环线"},{type:"ConvexGeometry",name:"围栏"}]},{type:"addHelper",name:"添加辅助线",icon:"helper",subMenu:[{type:"GridHelper",name:"坐标格辅助"},{type:"PolarGridHelper",name:"极坐标格辅助"}]},{type:"addModel",name:"添加模型",icon:"model"},{type:"addGroup",name:"添加分组",icon:"group"},{type:"addCamera",name:"添加相机",icon:"camera"}]}},created(){},methods:{add(){this.edit({})},edit(e){this.hyThree=new C,e.id&&(this.mdl={idx:e.id,nodeName:e.label,parentId:e.parentId}),this.visible=!0,e.json&&setTimeout((()=>{this.init(e.json)}),0)},init(e){this.hyThree.setEngineMode("EDIT"),this.hyThree.setOnSelectListener(this.mouseSelectNode),this.hyThree.init("display",e),this.propNode=this.hyThree.getPropListTree()},selectTree(e){const t=e[0];if(t){this.editNode=null;const a=this.hyThree.findNodeById(t);this.editNode=a,this.selectedKeys=e,this.hyThree.clickNodeObject(t)}},editInputChange(e,t){this.hyThree.setNodeProp(this.editNode.uuid,e,t)},editInputChange2(e,t,a){this.hyThree.setNodeProp(this.editNode.uuid,e,t,a)},clearMenu(){this.NodeTreeItem=null,this.closeColorPicker()},handleOk(){},handleCancel(){this.visible=!1,this.propNode&&(this.hyThree.stop(),this.hyThree=null,this.isShowStats=!1),this.propNode=null,this.editNode={},this.editNode.params=[]},beforeUpload(e){const t=this;if(!/json$/.test(e.name))return/thy$/.test(e.name)?this.uploadTHY(e):this.$message.error("只能选择json文件或thy文件"),!1;var a=new FileReader;return a.readAsText(e),a.onload=function(){const e=JSON.parse(this.result);null===e?t.$message.error("文件数据源错误，无法解析"):(t.$message.success("文件导入成功，正在解析"),t.init(e))},!1},uploadTHY(e){const t=this;var a=new FileReader;a.readAsDataURL(e),a.onload=function(){let e=this.result.split(",")[1],a=t.hyThree.decryptJson(e);null===a?t.$message.error("文件数据源错误，无法解析"):(t.$message.success("文件导入成功，正在解析"),t.init(a))}},logNode(){},logTHREE(){this.hyThree.getthreeNode()},exportJSON(){const e=this.propNode[0].name+".json",t=JSON.stringify(this.propNode),a=new Blob([t],{type:"text/json"});this.exportFile(e,a)},exportBlob(){const e=this.propNode[0].name+".thy";let t=this.hyThree.exportBlob();this.exportFile(e,t)},exportFile(e,t,a){const i=document.createElement("a");i.setAttribute("download",e),i.href=a||window.URL.createObjectURL(t),i.click()},exportImage(){const e=this.propNode[0].name+"";let t=this.hyThree.exportImage();this.exportFile(e,null,t)},exportGltf(){const e=this.propNode[0].name+".gltf";this.hyThree.exportGltf().then((t=>{const a=JSON.stringify(t),i=new Blob([a],{type:"text/plain"});this.exportFile(e,i)}))},newScene(){this.hyThree.setEngineMode("EDIT"),this.hyThree.setOnSelectListener(this.mouseSelectNode),this.hyThree.create("display"),this.propNode=this.hyThree.getPropListTree()},setStatsShow(){this.isShowStats=!this.isShowStats,this.hyThree.setStatsShow(this.isShowStats)},rightClick({event:e,node:t}){const a=e.clientX,i=e.clientY;this.tmpStyle={left:`${a}px`,top:`${i}px`},this.NodeTreeItem={pageX:a,pageY:i,uuid:t.dataRef.uuid},this.NodeTreeItem.menu=this.hyThree.getMenu(t.dataRef.type)},clickRightMenu(e,t){switch(e){case"addModel":this.$refs.modelModal.add(t);break;case"addEvent":this.$refs.eventModal.add(t);break;default:this.hyThree.clickRightMenu(e,t)}this.clearMenu()},updateColor(e){this.colorPicker.item.value=e.hex,this.editInputChange(this.colorPicker.item.key,this.colorPicker.item.value)},changeColorPicker(e,t){const a=t.clientX,i=t.clientY;this.colorPicker.item&&this.colorPicker.item.key===e.key?this.colorPicker.isOpen=!this.colorPicker.isOpen:this.colorPicker.isOpen=!0,this.colorPicker.value=e.value,this.colorPicker.item=e,this.colorPicker.style={left:`${a}px`,top:`${i}px`,display:this.colorPicker.isOpen?"block":"none"},t.stopPropagation()},closeColorPicker(){this.colorPicker.isOpen=!1,this.colorPicker.style.display="none"},mouseSelectNode(e){e?this.selectTree([e]):(this.editNode={},this.editNode.params=[],this.selectedKeys=[])},setMode(e){this.hyThree.setTFControlsMode(e.key)},setMaterial(e){this.materialPicker.item=e,e.value?this.$refs.materialModal.edit(e.value):this.$refs.materialModal.add()},changeMaterial(e){this.materialPicker.item.value=e,this.editInputChange(this.materialPicker.item.key,this.materialPicker.item.value)},addModel(e,t){if(t)this.hyThree.addModel(e,t);else{let t=this.hyThree.findLateContainer(this.hyThree.selectObject);this.hyThree.addModel(e,t.uuid)}},onDragEnter(e){},canDrag(e){switch(e){case"Scene":case"Camera":case"Renderer":case"Controls":return!1;default:return!0}},canDrop(e){switch(e){case"Scene":case"Group":return!0;default:return!1}},loop(e,t,a){let i=e;for(let e=0;e<i.length;e++){const s=i[e];if(s.uuid===t)return a(s,e,i);if(s.children){let e=this.loop(s.children,t,a);if(e)return e}}},onDrop(e){const t=e.node.eventKey,a=e.dragNode.eventKey,i=e.node.pos.split("-"),s=e.dropPosition-Number(i[i.length-1]);if(!this.canDrag(e.dragNode.dataRef.type))return void this.$message.error("该元素无法拖拽，请选择场景中的元素");if(!e.dropToGap&&!this.canDrop(e.node.dataRef.type))return void this.$message.error("无法拖拽到该元素内部");if(e.dropToGap&&!this.canDrag(e.node.dataRef.type))return void this.$message.error("无法拖拽到该位置");let r;this.loop(this.propNode,a,((e,t,a)=>(a.splice(t,1),r=e,!0))),this.loop(this.propNode,t,((i,l,n)=>(e.dropToGap?s>0?n.splice(l+1,0,r):n.splice(l,0,r):(i.children=i.children||[],i.children.push(r)),this.hyThree.dropTo(a,t,e.dropToGap),!0)))},preview(e){this.$refs.previewModal.open(this.propNode,e)},addEvent(e,t){t?(this.hyThree.addEvent(e,t),this.selectTree([t])):(this.editNode.events.splice(this.eventIndex,1,e),this.selectTree([this.editNode.uuid]))},editEvent(e,t){this.$refs.eventModal.edit(e),this.eventIndex=t},delEvent(e,t){this.editNode.events.splice(t,1),this.editNode.events.length||(this.editNode.events=null,this.hyThree.removeEvent(this.editNode.uuid))}}},F=(0,G.Z)(B,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:"100%",visible:e.visible,maskClosable:!1,bodyStyle:e.bodyStyle,dialogStyle:e.dialogStyle,footer:null,wrapClassName:"full-modal"},on:{cancel:e.handleCancel}},[t("div",{staticClass:"edit-box"},[t("div",{staticClass:"top"},[e.propNode?e._e():t("a-upload",{attrs:{accept:".json,.thy",beforeUpload:e.beforeUpload,fileList:e.fileList}},[t("a-button",{attrs:{title:"导入场景文件，继续编辑",type:"primary"}},[e._v("导入")])],1),e.propNode?e._e():t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"创建一个新的场景"},on:{click:e.newScene}},[e._v("新建场景")]),e.propNode?e._e():t("span",{staticClass:"tips"},[e._v("请先新建或导入场景")]),e.propNode?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"导出场景后，下次可导入继续编辑"},on:{click:e.exportBlob}},[e._v("导出")]):e._e(),e.propNode?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"截取当前画面"},on:{click:e.exportImage}},[e._v("导出图片")]):e._e(),e.propNode?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"将场景对象导出成gltf模型"},on:{click:e.exportGltf}},[e._v("导出模型")]):e._e(),e.propNode&&!e.isShowStats?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"显示当前帧率、内存占用信息"},on:{click:function(t){return e.setStatsShow()}}},[e._v("帧率显示")]):e._e(),e.propNode&&e.isShowStats?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"关闭当前帧率、内存占用信息"},on:{click:function(t){return e.setStatsShow()}}},[e._v("帧率关闭")]):e._e(),e.propNode?t("a-dropdown",[t("a-menu",{attrs:{slot:"overlay"},on:{click:e.setMode},slot:"overlay"},e._l(e.controlsMode,(function(a){return t("a-menu-item",{key:a.type},[e._v(e._s(a.title))])})),1),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"双击选中场景里面的对象"}},[e._v(" 转换模式 "),t("a-icon",{attrs:{type:"down"}})],1)],1):e._e(),e.propNode?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"预览当前场景"},on:{click:function(t){return e.preview("RUN")}}},[e._v("预览")]):e._e(),e.propNode?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{title:"多屏预览当前场景（多相机模式）"},on:{click:function(t){return e.preview("MULTI")}}},[e._v("多屏")]):e._e()],1),t("div",{staticClass:"content"},[t("div",{staticClass:"edit-quick"},[e._l(e.quickList,(function(a){return t("div",{key:a.type,staticClass:"quick-item"},[a.subMenu?t("a-popover",{attrs:{placement:"rightTop"}},[t("template",{slot:"content"},e._l(a.subMenu,(function(a){return t("p",{key:a.type,staticStyle:{cursor:"pointer"},on:{click:function(t){return e.clickRightMenu(a.type)}}},[e._v(" "+e._s(a.name))])})),0),t("img",{staticClass:"quick-icon",attrs:{src:"/img/"+a.icon+".png",alt:"",title:a.name}})],2):t("img",{staticClass:"quick-icon",attrs:{src:"/img/"+a.icon+".png",alt:"",title:a.name},on:{click:function(t){return e.clickRightMenu(a.type)}}})],1)})),e.propNode?e._e():t("div",{staticClass:"quick-mask"})],2),t("div",{staticClass:"edit-canvas"},[t("div",{staticClass:"canvas",attrs:{id:"display"}})]),t("div",{staticClass:"edit-operat"},[t("div",{staticClass:"edit-node"},[t("div",{staticClass:"map-name",on:{click:function(t){return e.selectMap()}}}),e.propNode?t("div",{staticClass:"map-tree",on:{click:e.clearMenu}},[t("a-tree",{attrs:{treeData:e.propNode,replaceFields:e.replaceFields,showIcon:"",defaultExpandAll:"",selectedKeys:e.selectedKeys,draggable:""},on:{rightClick:e.rightClick,select:e.selectTree,drop:e.onDrop}}),e.NodeTreeItem?t("div",{staticClass:"right-menu",style:e.tmpStyle},[t("a-menu",[e._l(e.NodeTreeItem.menu,(function(a){return[a.subMenu?t("a-sub-menu",{key:a.type+1,attrs:{title:a.name}},e._l(a.subMenu,(function(a){return t("a-menu-item",{key:a.type,on:{click:function(t){return e.clickRightMenu(a.type,e.NodeTreeItem.uuid)}}},[e._v(e._s(a.name))])})),1):t("a-menu-item",{key:a.type,on:{click:function(t){return e.clickRightMenu(a.type,e.NodeTreeItem.uuid)}}},[e._v(e._s(a.name))])]}))],2)],1):e._e()],1):e._e()]),t("div",{staticClass:"edit-attribute",on:{click:e.clearMenu}},[t("div",{staticClass:"attribute-name"},[e.editNode.params.length?t("h2",[e._v("属性编辑")]):e._e()]),t("div",{staticClass:"attribute-box"},[e._l(e.editNode.params,(function(a){return t("div",{key:a.key},[a.isShow?t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:a.name}},["number"==a.type?t("a-input-number",{attrs:{min:a.min,max:a.max,step:a.step,disabled:!a.isEdit},on:{change:function(t){return e.editInputChange(a.key,a.value)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"string"==a.type?t("a-input",{on:{change:function(t){return e.editInputChange(a.key,a.value)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"boolean"==a.type?t("a-switch",{on:{change:function(t){return e.editInputChange(a.key,a.value)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"color"==a.type?t("div",{staticClass:"color-picker-btn",on:{click:function(t){return e.changeColorPicker(a,t)}}},[t("div",{staticClass:"color-show",style:{backgroundColor:a.value}},[t("a-icon",{staticClass:"color-icon",attrs:{type:"swap"}})],1)]):e._e(),"material"==a.type?t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.setMaterial(a)}}},[e._v("设置 ")]):e._e(),"object"==a.type?t("div",{class:a.flex?"flex":""},e._l(a.value,(function(i){return t("div",{key:i.key,staticClass:"obj-item"},[i.isShow?t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:i.name}},["number"==i.type?t("a-input-number",{attrs:{min:i.min,max:i.max,step:i.step,disabled:!i.isEdit},on:{change:function(t){return e.editInputChange2(a.key,i.value,i.key)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"i.value"}}):e._e(),"string"==i.type?t("a-input",{on:{change:function(t){return e.editInputChange2(a.key,i.value,i.key)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"i.value"}}):e._e(),"boolean"==i.type?t("a-switch",{on:{change:function(t){return e.editInputChange2(a.key,i.value,i.key)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"i.value"}}):e._e(),"select"==i.type?t("a-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.editInputChange2(a.key,i.value,i.key)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"i.value"}},e._l(i.list,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.name)+" ")])})),1):e._e()],1):e._e()],1)})),0):e._e()],1):e._e()],1)})),e.editNode.events?t("a-form-item",{attrs:{labelCol:e.labelCol2,wrapperCol:e.wrapperCol2,label:"绑定事件"}},e._l(e.editNode.events,(function(a,i){return t("div",{key:a.uuid},[t("span",[e._v(e._s(a.name))]),t("a-icon",{staticClass:"event-btn",staticStyle:{color:"#1890ff"},attrs:{type:"form"},on:{click:function(t){return e.editEvent(a,i)}}}),t("a-icon",{staticClass:"event-btn",staticStyle:{color:"#f44336"},attrs:{type:"close-square"},on:{click:function(t){return e.delEvent(a,i)}}})],1)})),0):e._e()],2)])])])]),t("div",{staticClass:"color-picker",style:e.colorPicker.style},[t("chrome-picker",{on:{input:e.updateColor},model:{value:e.colorPicker.value,callback:function(t){e.$set(e.colorPicker,"value",t)},expression:"colorPicker.value"}})],1),t("MaterialModal",{ref:"materialModal",on:{ok:e.changeMaterial}}),t("ModelModal",{ref:"modelModal",on:{ok:e.addModel}}),t("PreviewModal",{ref:"previewModal"}),t("EventModal",{ref:"eventModal",on:{ok:e.addEvent}})],1)}),[],!1,null,"64bf8d9b",null).exports;let $={0:"3910d2e3adfd0dc2e3a048f15c11eb74",1:"a42a596fc71e17828440030074d15e74",2:"af94ed0d6f5acc95f97170e3685f16c0",3:"95d309f0b035d97f69902e7972c2b2e6",4:"19f01591b6ca3ba03f1aedc8db12cdb9",5:"93c83a131fa0fd208e161910a17519c4",6:"c16882e007c5c7a773acd7c5e8869ab7",7:"e53a0a2978c28872a4505bdb51db06dc",8:"db68512896941514a089c37392f0683b",9:"6c90885b28e58d1f44856d787da2078f",10:"a4fa7175d4757e45eac71a8487751f63",11:"07ac7cd13fd0eb1654ccdbd222b81437",12:"2cc73b24083105c3d488cc61b606d4f0",13:"9a555403384fc12f931656dea910e334",14:"e6a4f65e7355bb8b7671c3a18003b146",15:"feb93033a7ab04ea442b08103ec019a4",16:"040d45ccc13c070fcec9d46ccd0cc543",17:"e234e195f3789f05483378c397db1cb5",18:"d339a8932df05de23ae3d9e29df4b25f",19:"0887f1a5b9970ad13f46b8c1485f7900",20:"3b036b877a6a074d7dbfc706fe868c1d",21:"c6a01432c8138d46ba39957a8250e027",22:"07577d9f755d42cec7545e889b7261a3",23:"777669af68dbccabc30c3b6bcaa81825",24:"873be0705c80679f2c71fbf4d872df59",25:"988f9153ac4fd966ea302dd9ab9bae15",26:"a660d4563b8f62dd5282319cc643d950",27:"1160453108d3e537255e9f7b931f4e90",28:"456048afb7253926e1fbb7486e699180",29:"bb4abc56ac2093f48c7c26980ec4a4c0",30:"c2ddc87b68fed4f62a29c1ff816f58b0",31:"90dd303abffdd2a14f11d4819e795dc9",32:"3d36c07721a0a5a96436d6c536a132ec",33:"2201611d7a08ffda97e3e8c6b667a1bc",34:"9c415bdd4dd66723ef7b38853ef35ddb",35:"802a5fd4efb36391dfa8f1991fd0f849",36:"802a5fd4efb36391dfa8f1991fd0f849",37:"18de4beb01f6a17b6e1dfb9813ba6045",38:"52ff52aa56d10a1287274ecf02dccb5f",39:"12b668a1ada1828ba795332f419d4ef7",40:"e7e8f8e5982b3298c8addedf6811d500",41:"792c7b5aae4a79e78aaeda80516ae2ac",42:"11dd08ef8df49a1f37b1ed2da261b36f"};var J={name:"App",components:{PreviewModal:H,ThreeEditModal:F},data(){return{showTips:!1,visible:!1,code:"",hyThree:null,authNext:null,list:[{key:"网格对象与材质",mode:"RUN"},{key:"网格对象和灯光",mode:"RUN"},{key:"灯光与阴影",mode:"RUN"},{key:"模型360度展示",mode:"RUN"},{key:"模型多相机切换",mode:"RUN"},{key:"模型多屏展示",mode:"MULTI"},{key:"点击与双击事件",mode:"RUN"},{key:"合并网格对象",mode:"RUN"},{key:"模型导出",mode:"RUN"},{key:"全景图",mode:"RUN"},{key:"太阳与地球",mode:"RUN"},{key:"模型与动画",mode:"RUN"},{key:"模型与标签",mode:"RUN"}]}},mounted(){this.list.reverse(),this.hyThree=new C},methods:{openEditModal(){this.checkAuth()?this.$refs.threeEditModal.add():(this.authNext=null,this.visible=!0)},handleOk(){this.checkAuth(this.code)?(this.authNext?this.readUrl(this.authNext):this.$refs.threeEditModal.add(),this.showTips=!1,this.visible=!1):this.handleCancel()},preview(e){let t="/example/"+e.key+".thy",a=new XMLHttpRequest;a.open("get",t,!0),a.responseType="blob",a.onload=t=>{this.readFile(t.target.response).then((t=>{this.$refs.previewModal.open(t,e.mode)}))},a.send()},edit(e){this.checkAuth()?this.readUrl(e):(this.authNext=e,this.visible=!0)},readUrl(e){let t="/example/"+e.key+".thy",a=new XMLHttpRequest;a.open("get",t,!0),a.responseType="blob",a.onload=e=>{this.readFile(e.target.response).then((e=>{this.$refs.threeEditModal.edit({json:e})}))},a.send()},readFile(e){const t=this;return new Promise(((a,i)=>{var s=new FileReader;s.readAsDataURL(e),s.onload=function(){let e=this.result.split(",")[1],s=t.hyThree.decryptJson(e);null===s?(t.$message.error("文件数据源错误，无法解析"),i("文件数据源错误，无法解析")):a(s)}}))},handleCancel(){this.showTips=!0,this.visible=!1},checkAuth(e){let t=e||this.getSearch(),a=localStorage.getItem("code"),i=l.MD5(t).toString();return l.MD5(a).toString()===this.getTodayVerify()||(i===this.getTodayVerify()?(localStorage.setItem("code",t),!0):"1305861714"===t&&(localStorage.removeItem("code"),!0))},getSearch(){return window.location.search.substring(1)},getTodayVerify(){let e=new Date,t=e.getMonth(),a=e.getDate();return $[t+a]},getRandomFixedLength(e){return this.padding2(Math.floor(Math.random()*Math.pow(10,e)),e)},padding(e,t){let a=e/Math.pow(10,t);return a=a.toFixed(t)+"",a.substr(a.indexOf(".")+1)},padding2(e,t){return(e+Math.pow(10,t)+"").substring(1)}}},Z=(0,G.Z)(J,(function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("div",{staticClass:"page"},[e.showTips?t("a-alert",{attrs:{message:"访问权限已过期，请联系作者（13680320650）获取访问权限码",banner:""}}):e._e(),e._m(0),t("div",{staticClass:"page-sub-title"},[e._v("一款致力于解决非3D开发人员快速化部署3D场景的软件")]),t("div",{staticClass:"boxs"},[t("div",{staticClass:"box"},[t("div",{staticClass:"item add",on:{click:function(t){return e.openEditModal()}}},[t("a-icon",{staticClass:"icon",attrs:{title:"打开场景编辑",type:"plus"}}),t("div",{staticClass:"text"},[e._v("自定义场景")])],1)]),e._l(e.list,(function(a){return t("div",{key:a.key,staticClass:"box"},[t("div",{staticClass:"item"},[t("img",{staticClass:"img",attrs:{src:"/example/"+a.key+".png",alt:a.key},on:{click:function(t){return e.preview(a)}}}),t("div",{staticClass:"title"},[t("div",{staticClass:"text"},[e._v(e._s(a.key))]),t("a-icon",{staticClass:"icon",attrs:{title:"打开场景编辑",type:"edit"},on:{click:function(t){return e.edit(a)}}})],1)])])}))],2)],1),t("three-edit-modal",{ref:"threeEditModal"}),t("a-modal",{attrs:{title:"输入权限码",visible:e.visible,cancelText:"取消",okText:"确定"},on:{ok:e.handleOk,cancel:e.handleCancel}},[t("a-input",{attrs:{placeholder:"请联系作者（13680320650）获取访问权限码"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),t("PreviewModal",{ref:"previewModal"})],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-title"},[e._v("wangThreeEditer "),t("span",[e._v("v0.5 体验版")])])}],!1,null,"6aab9be6",null).exports,q=a(74399),W=a(60575),X=a(2195),Y=a(7525),V=a(51422),K=a(92117),Q=a(7205),ee=a(25431),te=a(88178),ae=a(7983),ie=a(88895),se=a(58843),re=a(62776),le=a(10618),ne=a(47644);a(62467);i.ZP.use(q.Z),i.ZP.use(W.Z),i.ZP.use(X.Z),i.ZP.use(Y.Z),i.ZP.use(V.Z),i.ZP.use(K.Z),i.ZP.use(Q.ZP),i.ZP.use(ee.Z),i.ZP.use(te.ZP),i.ZP.use(ae.Z),i.ZP.use(ie.ZP),i.ZP.use(se.ZP),i.ZP.use(re.Z),i.ZP.use(le.ZP),i.ZP.prototype.$message=ne.Z,i.ZP.config.productionTip=!1,new i.ZP({render:e=>e(Z)}).$mount("#app")}},a={};function i(e){var s=a[e];if(void 0!==s)return s.exports;var r=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,e=[],i.O=function(t,a,s,r){if(!a){var l=1/0;for(c=0;c<e.length;c++){a=e[c][0],s=e[c][1],r=e[c][2];for(var n=!0,o=0;o<a.length;o++)(!1&r||l>=r)&&Object.keys(i.O).every((function(e){return i.O[e](a[o])}))?a.splice(o--,1):(n=!1,r<l&&(l=r));if(n){e.splice(c--,1);var h=s();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[a,s,r]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,r,l=a[0],n=a[1],o=a[2],h=0;if(l.some((function(t){return 0!==e[t]}))){for(s in n)i.o(n,s)&&(i.m[s]=n[s]);if(o)var c=o(i)}for(t&&t(a);h<l.length;h++)r=l[h],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},a=self.webpackChunkwangThreeEditer=self.webpackChunkwangThreeEditer||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var s=i.O(void 0,[998],(function(){return i(94074)}));s=i.O(s)}();